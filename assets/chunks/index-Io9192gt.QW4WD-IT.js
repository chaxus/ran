import{a as _t,e as cs,t as lt,b as as}from"./index.AIO7hmNT.js";import{g as ds,a as fs}from"./colz-gx7fTFHI.65el2PIW.js";import"./framework.jpv7BUPb.js";var us=Object.defineProperty,gs=(l,t,e)=>t in l?us(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,H=(l,t,e)=>(gs(l,typeof t!="symbol"?t+"":t,e),e);class st{constructor(t,e=""){typeof t=="string"?(this.el=document.createElement(t),this.el.className=e):this.el=t,this.data={}}data(t,e){return e!==void 0?(this.data[t]=e,this):this.data[t]}on(t,e){const[s,...i]=t.split(".");let r=s;return r==="mousewheel"&&/Firefox/i.test(window.navigator.userAgent)&&(r="DOMMouseScroll"),this.el.addEventListener(r,n=>{e(n);for(let o=0;o<i.length;o+=1){const h=i[o];if(h==="left"&&n.button!==0||h==="right"&&n.button!==2)return;h==="stop"&&n.stopPropagation()}}),this}offset(t){if(t!==void 0)return Object.keys(t).forEach(n=>{this.css(n,`${t[n]}px`)}),this;const{offsetTop:e,offsetLeft:s,offsetHeight:i,offsetWidth:r}=this.el;return{top:e,left:s,height:i,width:r}}scroll(t){const{el:e}=this;return t!==void 0&&(t.left!==void 0&&(e.scrollLeft=t.left),t.top!==void 0&&(e.scrollTop=t.top)),{left:e.scrollLeft,top:e.scrollTop}}box(){return this.el.getBoundingClientRect()}parent(){return new st(this.el.parentNode)}children(...t){return arguments.length===0?this.el.childNodes:(t.forEach(e=>this.child(e)),this)}removeChild(t){this.el.removeChild(t)}child(t){let e=t;return typeof t=="string"?e=document.createTextNode(t):t instanceof st&&(e=t.el),this.el.appendChild(e),this}contains(t){return this.el.contains(t)}className(t){return t!==void 0?(this.el.className=t,this):this.el.className}addClass(t){return this.el.classList.add(t),this}hasClass(t){return this.el.classList.contains(t)}removeClass(t){return this.el.classList.remove(t),this}toggle(t="active"){return this.toggleClass(t)}toggleClass(t){return this.el.classList.toggle(t)}active(t=!0,e="active"){return t?this.addClass(e):this.removeClass(e),this}checked(t=!0){return this.active(t,"checked"),this}disabled(t=!0){return t?this.addClass("disabled"):this.removeClass("disabled"),this}attr(t,e){if(e!==void 0)this.el.setAttribute(t,e);else{if(typeof t=="string")return this.el.getAttribute(t);Object.keys(t).forEach(s=>{this.el.setAttribute(s,t[s])})}return this}removeAttr(t){return this.el.removeAttribute(t),this}html(t){return t!==void 0?(this.el.innerHTML=t,this):this.el.innerHTML}val(t){return t!==void 0?(this.el.value=t,this):this.el.value}focus(){this.el.focus()}cssRemoveKeys(...t){return t.forEach(e=>this.el.style.removeProperty(e)),this}css(t,e){return e===void 0&&typeof t!="string"?(Object.keys(t).forEach(s=>{this.el.style[s]=t[s]}),this):e!==void 0?(this.el.style[t]=e,this):this.el.style[t]}computedStyle(){return window.getComputedStyle(this.el,null)}show(){return this.css("display","block"),this}hide(){return this.css("display","none"),this}}const u=(l,t="")=>new st(l,t),X=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function Ve(l){let t="",e=l;for(;e>=X.length;)e/=X.length,e-=1,t+=X[parseInt(e,10)%X.length];const s=l%X.length;return t+=X[s],t}function ps(l){let t=0;for(let e=0;e<l.length-1;e+=1){const s=l.charCodeAt(e)-65,i=l.length-1-e;t+=X.length**i+X.length*s}return t+=l.charCodeAt(l.length-1)-65,t}function K(l){let t="",e="";for(let s=0;s<l.length;s+=1)l.charAt(s)>="0"&&l.charAt(s)<="9"?e+=l.charAt(s):t+=l.charAt(s);return[ps(t),parseInt(e,10)-1]}function q(l,t){return`${Ve(l)}${t+1}`}function ft(l,t,e,s=()=>!0){if(t===0&&e===0)return l;const[i,r]=K(l);return s(i,r)?q(i+t,r+e):l}class F{constructor(t,e,s,i,r=0,n=0){this.sri=t,this.sci=e,this.eri=s,this.eci=i,this.w=r,this.h=n}set(t,e,s,i){this.sri=t,this.sci=e,this.eri=s,this.eci=i}multiple(){return this.eri-this.sri>0||this.eci-this.sci>0}includes(...t){let[e,s]=[0,0];t.length===1?[s,e]=K(t[0]):t.length===2&&([e,s]=t);const{sri:i,sci:r,eri:n,eci:o}=this;return i<=e&&e<=n&&r<=s&&s<=o}each(t,e=()=>!0){const{sri:s,sci:i,eri:r,eci:n}=this;for(let o=s;o<=r;o+=1)if(e(o))for(let h=i;h<=n;h+=1)t(o,h)}contains(t){return this.sri<=t.sri&&this.sci<=t.sci&&this.eri>=t.eri&&this.eci>=t.eci}within(t){return this.sri>=t.sri&&this.sci>=t.sci&&this.eri<=t.eri&&this.eci<=t.eci}disjoint(t){return this.sri>t.eri||this.sci>t.eci||t.sri>this.eri||t.sci>this.eci}intersects(t){return this.sri<=t.eri&&this.sci<=t.eci&&t.sri<=this.eri&&t.sci<=this.eci}union(t){const{sri:e,sci:s,eri:i,eci:r}=this;return new F(t.sri<e?t.sri:e,t.sci<s?t.sci:s,t.eri>i?t.eri:i,t.eci>r?t.eci:r)}difference(t){const e=[],s=(f,g,p,w)=>{e.push(new F(f,g,p,w))},{sri:i,sci:r,eri:n,eci:o}=this,h=t.sri-i,c=t.sci-r,d=n-t.eri,a=o-t.eci;return h>0?(s(i,r,t.sri-1,o),d>0?(s(t.eri+1,r,n,o),c>0&&s(t.sri,r,t.eri,t.sci-1),a>0&&s(t.sri,t.eci+1,t.eri,o)):(c>0&&s(t.sri,r,n,t.sci-1),a>0&&s(t.sri,t.eci+1,n,o))):d>0&&(s(t.eri+1,r,n,o),c>0&&s(i,r,t.eri,t.sci-1),a>0&&s(i,t.eci+1,t.eri,o)),c>0?(s(i,r,n,t.sci-1),a>0?(s(i,t.eri+1,n,o),h>0&&s(i,t.sci,t.sri-1,t.eci),d>0&&s(t.sri+1,t.sci,n,t.eci)):(h>0&&s(i,t.sci,t.sri-1,o),d>0&&s(t.sri+1,t.sci,n,o))):a>0&&(s(n,t.eci+1,n,o),h>0&&s(i,r,t.sri-1,t.eci),d>0&&s(t.eri+1,r,n,t.eci)),e}size(){return[this.eri-this.sri+1,this.eci-this.sci+1]}toString(){const{sri:t,sci:e,eri:s,eci:i}=this;let r=q(e,t);return this.multiple()&&(r=`${r}:${q(i,s)}`),r}clone(){const{sri:t,sci:e,eri:s,eci:i,w:r,h:n}=this;return new F(t,e,s,i,r,n)}equals(t){return this.eri===t.eri&&this.eci===t.eci&&this.sri===t.sri&&this.sci===t.sci}static valueOf(t){const e=t.split(":"),[s,i]=K(e[0]);let[r,n]=[i,s];return e.length>1&&([n,r]=K(e[1])),new F(i,s,r,n)}}let ms=class{constructor(){this.range=new F(0,0,0,0),this.ri=0,this.ci=0}multiple(){return this.range.multiple()}setIndexes(t,e){this.ri=t,this.ci=e}size(){return this.range.size()}};class ws{constructor(){this.x=0,this.y=0,this.ri=0,this.ci=0}}class bs{constructor(){this.undoItems=[],this.redoItems=[]}add(t){this.undoItems.push(JSON.stringify(t)),this.redoItems=[]}canUndo(){return this.undoItems.length>0}canRedo(){return this.redoItems.length>0}undo(t,e){const{undoItems:s,redoItems:i}=this;this.canUndo()&&(i.push(JSON.stringify(t)),e(JSON.parse(s.pop())))}redo(t,e){const{undoItems:s,redoItems:i}=this;this.canRedo()&&(s.push(JSON.stringify(t)),e(JSON.parse(i.pop())))}}class vs{constructor(){this.range=null,this.state="clear"}copy(t){return this.range=t,this.state="copy",this}cut(t){return this.range=t,this.state="cut",this}isCopy(){return this.state==="copy"}isCut(){return this.state==="cut"}isClear(){return this.state==="clear"}clear(){this.range=null,this.state="clear"}}class ge{constructor(t,e,s){this.ci=t,this.operator=e,this.value=s}set(t,e){this.operator=t,this.value=e}includes(t){const{operator:e,value:s}=this;return e==="all"?!0:e==="in"?s.includes(t):!1}vlength(){const{operator:t,value:e}=this;return t==="in"?e.length:0}getData(){const{ci:t,operator:e,value:s}=this;return{ci:t,operator:e,value:s}}}class pe{constructor(t,e){this.ci=t,this.order=e}asc(){return this.order==="asc"}desc(){return this.order==="desc"}}class xs{constructor(){this.ref=null,this.filters=[],this.sort=null}setData({ref:t,filters:e,sort:s}){t!=null&&(this.ref=t,this.filters=e.map(i=>new ge(i.ci,i.operator,i.value)),s&&(this.sort=new pe(s.ci,s.order)))}getData(){if(this.active()){const{ref:t,filters:e,sort:s}=this;return{ref:t,filters:e.map(i=>i.getData()),sort:s}}return{}}addFilter(t,e,s){const i=this.getFilter(t);i==null?this.filters.push(new ge(t,e,s)):i.set(e,s)}setSort(t,e){this.sort=e?new pe(t,e):null}includes(t,e){return this.active()?this.hrange().includes(t,e):!1}getSort(t){const{sort:e}=this;return e&&e.ci===t?e:null}getFilter(t){const{filters:e}=this;for(let s=0;s<e.length;s+=1)if(e[s].ci===t)return e[s];return null}filteredRows(t){const e=new Set,s=new Set;if(this.active()){const{sri:i,eri:r}=this.range(),{filters:n}=this;for(let o=i+1;o<=r;o+=1)for(let h=0;h<n.length;h+=1){const c=n[h],d=t(o,c.ci),a=d?d.text:"";if(c.includes(a))s.add(o);else{e.add(o);break}}}return{rset:e,fset:s}}items(t,e){const s={};if(this.active()){const{sri:i,eri:r}=this.range();for(let n=i+1;n<=r;n+=1){const o=e(n,t);if(o!==null&&!/^\s*$/.test(o.text)){const h=o.text,c=(s[h]||0)+1;s[h]=c}else s[""]=(s[""]||0)+1}}return s}range(){return F.valueOf(this.ref)}hrange(){const t=this.range();return t.eri=t.sri,t}clear(){this.ref=null,this.filters=[],this.sort=null}active(){return this.ref!==null}}class le{constructor(t=[]){this._=t}forEach(t){this._.forEach(t)}deleteWithin(t){this._=this._.filter(e=>!e.within(t))}getFirstIncludes(t,e){for(let s=0;s<this._.length;s+=1){const i=this._[s];if(i.includes(t,e))return i}return null}filterIntersects(t){return new le(this._.filter(e=>e.intersects(t)))}intersects(t){for(let e=0;e<this._.length;e+=1)if(this._[e].intersects(t))return!0;return!1}union(t){let e=t;return this._.forEach(s=>{s.intersects(e)&&(e=s.union(e))}),e}add(t){this.deleteWithin(t),this._.push(t)}shift(t,e,s,i){this._.forEach(r=>{const{sri:n,sci:o,eri:h,eci:c}=r,d=r;t==="row"?n>=e?(d.sri+=s,d.eri+=s):n<e&&e<=h&&(d.eri+=s,i(n,o,s,0)):t==="column"&&(o>=e?(d.sci+=s,d.eci+=s):o<e&&e<=c&&(d.eci+=s,i(n,o,0,s)))})}move(t,e,s){this._.forEach(i=>{const r=i;r.within(t)&&(r.eri+=e,r.sri+=e,r.sci+=s,r.eci+=s)})}setData(t){return this._=t.map(e=>F.valueOf(e)),this}getData(){return this._.map(t=>t.toString())}}function ys(l){return JSON.parse(JSON.stringify(l))}const Le=(l={},...t)=>(t.forEach(e=>{Object.keys(e).forEach(s=>{const i=e[s];typeof i=="string"||typeof i=="number"||typeof i=="boolean"?l[s]=i:typeof i!="function"&&!Array.isArray(i)&&i instanceof Object?(l[s]=l[s]||{},Le(l[s],i)):l[s]=i})}),l);function Zt(l,t){const e=Object.keys(l);if(e.length!==Object.keys(t).length)return!1;for(let s=0;s<e.length;s+=1){const i=e[s],r=l[i],n=t[i];if(n===void 0)return!1;if(typeof r=="string"||typeof r=="number"||typeof r=="boolean"){if(r!==n)return!1}else if(Array.isArray(r)){if(r.length!==n.length)return!1;for(let o=0;o<r.length;o+=1)if(!Zt(r[o],n[o]))return!1}else if(typeof r!="function"&&!Array.isArray(r)&&r instanceof Object&&!Zt(r,n))return!1}return!0}const Cs=(l,t=e=>e)=>{let e=0,s=0;return Object.keys(l).forEach(i=>{e+=t(l[i],i),s+=1}),[e,s]};function ks(l,t){const e=l[`${t}`];return delete l[`${t}`],e}function Es(l,t,e,s,i,r){let n=e,o=s,h=l;for(;h<t&&!(n>i);h+=1)o=r(h),n+=o;return[h,n-o,o]}function Ss(l,t,e){let s=0;for(let i=l;i<t;i+=1)s+=e(i);return s}function Fs(l,t,e){for(let s=l;s<t;s+=1)e(s)}function $s(l,t){if(l.length===t.length){for(let e=0;e<l.length;e+=1)if(l[e]!==t[e])return!1}else return!1;return!0}function Pt(l){const t=`${l}`;let e=0,s=!1;for(let i=0;i<t.length;i+=1)s===!0&&(e+=1),t.charAt(i)==="."&&(s=!0);return e}function Q(l,t,e){if(Number.isNaN(t)||Number.isNaN(e))return t+l+e;const s=Pt(t),i=Pt(e),r=Number(t),n=Number(e);let o=0;if(l==="-")o=r-n;else if(l==="+")o=r+n;else if(l==="*")o=r*n;else if(l==="/")return o=r/n,Pt(o)>5?o.toFixed(2):o;return o.toFixed(Math.max(s,i))}const R={cloneDeep:ys,merge:(...l)=>Le({},...l),equals:Zt,arrayEquals:$s,sum:Cs,rangeEach:Fs,rangeSum:Ss,rangeReduceIf:Es,deleteProperty:ks,numberCalc:Q};class Ds{constructor({len:t,height:e}){this._={},this.len=t,this.height=e}getHeight(t){if(this.isHide(t))return 0;const e=this.get(t);return e&&e.height?e.height:this.height}setHeight(t,e){const s=this.getOrNew(t);s.height=e}unhide(t){let e=t;for(;e>0&&(e-=1,this.isHide(e));)this.setHide(e,!1)}isHide(t){const e=this.get(t);return e&&e.hide}setHide(t,e){const s=this.getOrNew(t);e===!0?s.hide=!0:delete s.hide}setStyle(t,e){const s=this.getOrNew(t);s.style=e}sumHeight(t,e,s){return R.rangeSum(t,e,i=>s&&s.has(i)?0:this.getHeight(i))}totalHeight(){return this.sumHeight(0,this.len)}get(t){return this._[t]}getOrNew(t){return this._[t]=this._[t]||{cells:{}},this._[t]}getCell(t,e){const s=this.get(t);return s!==void 0&&s.cells!==void 0&&s.cells[e]!==void 0?s.cells[e]:null}getCellMerge(t,e){const s=this.getCell(t,e);return s&&s.merge?s.merge:[0,0]}getCellOrNew(t,e){const s=this.getOrNew(t);return s.cells[e]=s.cells[e]||{},s.cells[e]}setCell(t,e,s,i="all"){const r=this.getOrNew(t);i==="all"?r.cells[e]=s:i==="text"?(r.cells[e]=r.cells[e]||{},r.cells[e].text=s.text):i==="format"&&(r.cells[e]=r.cells[e]||{},r.cells[e].style=s.style,s.merge&&(r.cells[e].merge=s.merge))}setCellText(t,e,s){const i=this.getCellOrNew(t,e);i.editable!==!1&&(i.text=s)}copyPaste(t,e,s,i=!1,r=()=>{}){const{sri:n,sci:o,eri:h,eci:c}=t,d=e.sri,a=e.sci,f=e.eri,g=e.eci,[p,w]=t.size(),[b,v]=e.size();let C=!0,x=0;(f<n||g<o)&&(C=!1,f<n?x=b:x=v);for(let y=n;y<=h;y+=1)if(this._[y]){for(let S=o;S<=c;S+=1)if(this._[y].cells&&this._[y].cells[S])for(let A=d;A<=f;A+=p)for(let z=a;z<=g;z+=w){const T=A+(y-n),it=z+(S-o),W=R.cloneDeep(this._[y].cells[S]);if(i&&W&&W.text&&W.text.length>0){const{text:Z}=W;let J=z-a+(A-d)+2;if(C||(J-=x+1),Z[0]==="=")W.text=Z.replace(/[a-zA-Z]{1,3}\d+/g,P=>{let[G,j]=[0,0];return n===d?G=J-1:j=J-1,/^\d+$/.test(P)?P:ft(P,G,j)});else if(p<=1&&w>1&&(d>h||f<n)||w<=1&&p>1&&(a>c||g<o)||p<=1&&w<=1){const P=/[\\.\d]+$/.exec(Z);if(P!==null){const G=Number(P[0])+J-1;W.text=Z.substring(0,P.index)+G}}}this.setCell(T,it,W,s),r(T,it,W)}}}cutPaste(t,e){const s={};this.each(i=>{this.eachCells(i,r=>{let n=parseInt(i,10),o=parseInt(r,10);t.includes(i,r)&&(n=e.sri+(n-t.sri),o=e.sci+(o-t.sci)),s[n]=s[n]||{cells:{}},s[n].cells[o]=this._[i].cells[r]})}),this._=s}paste(t,e){if(t.length<=0)return;const{sri:s,sci:i}=e;t.forEach((r,n)=>{const o=s+n;r.forEach((h,c)=>{const d=i+c;this.setCellText(o,d,h)})})}insert(t,e=1){const s={};this.each((i,r)=>{let n=parseInt(i,10);n>=t&&(n+=e,this.eachCells(i,(o,h)=>{h.text&&h.text[0]==="="&&(h.text=h.text.replace(/[a-zA-Z]{1,3}\d+/g,c=>ft(c,0,e,(d,a)=>a>=t)))})),s[n]=r}),this._=s,this.len+=e}delete(t,e){const s=e-t+1,i={};this.each((r,n)=>{const o=parseInt(r,10);o<t?i[o]=n:r>e&&(i[o-s]=n,this.eachCells(r,(h,c)=>{c.text&&c.text[0]==="="&&(c.text=c.text.replace(/[a-zA-Z]{1,3}\d+/g,d=>ft(d,0,-s,(a,f)=>f>e)))}))}),this._=i,this.len-=s}insertColumn(t,e=1){this.each((s,i)=>{const r={};this.eachCells(s,(n,o)=>{let h=parseInt(n,10);h>=t&&(h+=e,o.text&&o.text[0]==="="&&(o.text=o.text.replace(/[a-zA-Z]{1,3}\d+/g,c=>ft(c,e,0,d=>d>=t)))),r[h]=o}),i.cells=r})}deleteColumn(t,e){const s=e-t+1;this.each((i,r)=>{const n={};this.eachCells(i,(o,h)=>{const c=parseInt(o,10);c<t?n[c]=h:c>e&&(n[c-s]=h,h.text&&h.text[0]==="="&&(h.text=h.text.replace(/[a-zA-Z]{1,3}\d+/g,d=>ft(d,-s,0,a=>a>e))))}),r.cells=n})}deleteCells(t,e="all"){t.each((s,i)=>{this.deleteCell(s,i,e)})}deleteCell(t,e,s="all"){const i=this.get(t);if(i!==null){const r=this.getCell(t,e);r!==null&&r.editable!==!1&&(s==="all"?delete i.cells[e]:s==="text"?(r.text&&delete r.text,r.value&&delete r.value):s==="format"?(r.style!==void 0&&delete r.style,r.merge&&delete r.merge):s==="merge"&&r.merge&&delete r.merge)}}maxCell(){const t=Object.keys(this._),e=t[t.length-1],s=this._[e];if(s){const{cells:i}=s,r=Object.keys(i),n=r[r.length-1];return[parseInt(e,10),parseInt(n,10)]}return[0,0]}each(t){Object.entries(this._).forEach(([e,s])=>{t(e,s)})}eachCells(t,e){this._[t]&&this._[t].cells&&Object.entries(this._[t].cells).forEach(([s,i])=>{e(s,i)})}setData(t){t.len&&(this.len=t.len,delete t.len),this._=t}getData(){const{len:t}=this;return Object.assign({len:t},this._)}}class Ts{constructor({len:t,width:e,indexWidth:s,minWidth:i}){this._={},this.len=t,this.width=e,this.indexWidth=s,this.minWidth=i}setData(t){t.len&&(this.len=t.len,delete t.len),this._=t}getData(){const{len:t}=this;return Object.assign({len:t},this._)}getWidth(t){if(this.isHide(t))return 0;const e=this._[t];return e&&e.width?e.width:this.width}getOrNew(t){return this._[t]=this._[t]||{},this._[t]}setWidth(t,e){const s=this.getOrNew(t);s.width=e}unhide(t){let e=t;for(;e>0&&(e-=1,this.isHide(e));)this.setHide(e,!1)}isHide(t){const e=this._[t];return e&&e.hide}setHide(t,e){const s=this.getOrNew(t);e===!0?s.hide=!0:delete s.hide}setStyle(t,e){const s=this.getOrNew(t);s.style=e}sumWidth(t,e){return R.rangeSum(t,e,s=>this.getWidth(s))}totalWidth(){return this.sumWidth(0,this.len)}}const Os={toolbar:{undo:"Undo",redo:"Redo",print:"Print",paintformat:"Paint format",clearformat:"Clear format",format:"Format",fontName:"Font",fontSize:"Font size",fontBold:"Font bold",fontItalic:"Font italic",underline:"Underline",strike:"Strike",color:"Text color",bgcolor:"Fill color",border:"Borders",merge:"Merge cells",align:"Horizontal align",valign:"Vertical align",textwrap:"Text wrapping",freeze:"Freeze cell",autofilter:"Filter",formula:"Functions",more:"More"},contextmenu:{copy:"Copy",cut:"Cut",paste:"Paste",pasteValue:"Paste values only",pasteFormat:"Paste format only",hide:"Hide",insertRow:"Insert row",insertColumn:"Insert column",deleteSheet:"Delete",deleteRow:"Delete row",deleteColumn:"Delete column",deleteCell:"Delete cell",deleteCellText:"Delete cell text",validation:"Data validations",cellprintable:"Enable export",cellnonprintable:"Disable export",celleditable:"Enable editing",cellnoneditable:"Disable editing"},print:{size:"Paper size",orientation:"Page orientation",orientations:["Landscape","Portrait"]},format:{normal:"Normal",text:"Plain Text",number:"Number",percent:"Percent",rmb:"RMB",usd:"USD",eur:"EUR",date:"Date",time:"Time",datetime:"Date time",duration:"Duration"},formula:{sum:"Sum",average:"Average",max:"Max",min:"Min",_if:"IF",and:"AND",or:"OR",concat:"Concat"},validation:{required:"it must be required",notMatch:"it not match its validation rule",between:"it is between {} and {}",notBetween:"it is not between {} and {}",notIn:"it is not in list",equal:"it equal to {}",notEqual:"it not equal to {}",lessThan:"it less than {}",lessThanEqual:"it less than or equal to {}",greaterThan:"it greater than {}",greaterThanEqual:"it greater than or equal to {}"},error:{pasteForMergedCell:"Unable to do this for merged cells"},calendar:{weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},button:{next:"Next",cancel:"Cancel",remove:"Remove",save:"Save",ok:"OK"},sort:{desc:"Sort Z -> A",asc:"Sort A -> Z"},filter:{empty:"empty"},dataValidation:{mode:"Mode",range:"Cell Range",criteria:"Criteria",modeType:{cell:"Cell",column:"Colun",row:"Row"},type:{list:"List",number:"Number",date:"Date",phone:"Phone",email:"Email"},operator:{be:"between",nbe:"not betwwen",lt:"less than",lte:"less than or equal to",gt:"greater than",gte:"greater than or equal to",eq:"equal to",neq:"not equal to"}}};let Jt=["en"];const qe={en:Os};function me(l,t){if(t)for(const e of Jt){if(!t[e])break;let s=t[e];const i=l.match(/(?:\\.|[^.])+/g);for(let r=0;r<i.length;r+=1){const n=i[r],o=s[n];if(!o)break;if(r===i.length-1)return o;s=o}}}function $(l){let t=me(l,qe);return!t&&window&&window.x_spreadsheet&&window.x_spreadsheet.$messages&&(t=me(l,window.x_spreadsheet.$messages)),t||""}function E(l){return()=>$(l)}function Ye(l,t,e=!1){e?Jt=[l]:Jt.unshift(l),t&&(qe[l]=t)}const we={phone:/^[1-9]\d{10}$/,email:/w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*/};function _(l,t,...e){let s="";return l||(s=$(`validation.${t}`,...e)),[l,s]}class je{constructor(t,e,s,i){this.required=e,this.value=s,this.type=t,this.operator=i,this.message=""}parseValue(t){const{type:e}=this;return e==="date"?new Date(t):e==="number"?Number(t):t}equals(t){let e=this.type===t.type&&this.required===t.required&&this.operator===t.operator;return e&&(Array.isArray(this.value)?e=R.arrayEquals(this.value,t.value):e=this.value===t.value),e}values(){return this.value.split(",")}validate(t){const{required:e,operator:s,value:i,type:r}=this;if(e&&/^\s*$/.test(t))return _(!1,"required");if(/^\s*$/.test(t))return[!0];if(we[r]&&!we[r].test(t))return _(!1,"notMatch");if(r==="list")return _(this.values().includes(t),"notIn");if(s){const n=this.parseValue(t);if(s==="be"){const[o,h]=i;return _(n>=this.parseValue(o)&&n<=this.parseValue(h),"between",o,h)}if(s==="nbe"){const[o,h]=i;return _(n<this.parseValue(o)||n>this.parseValue(h),"notBetween",o,h)}if(s==="eq")return _(n===this.parseValue(i),"equal",i);if(s==="neq")return _(n!==this.parseValue(i),"notEqual",i);if(s==="lt")return _(n<this.parseValue(i),"lessThan",i);if(s==="lte")return _(n<=this.parseValue(i),"lessThanEqual",i);if(s==="gt")return _(n>this.parseValue(i),"greaterThan",i);if(s==="gte")return _(n>=this.parseValue(i),"greaterThanEqual",i)}return[!0]}}class At{constructor(t,e,s){this.refs=e,this.mode=t,this.validator=s}includes(t,e){const{refs:s}=this;for(let i=0;i<s.length;i+=1)if(F.valueOf(s[i]).includes(t,e))return!0;return!1}addRef(t){this.remove(F.valueOf(t)),this.refs.push(t)}remove(t){const e=[];this.refs.forEach(s=>{const i=F.valueOf(s);i.intersects(t)?i.difference(t).forEach(n=>e.push(n.toString())):e.push(s)}),this.refs=e}getData(){const{refs:t,mode:e,validator:s}=this,{type:i,required:r,operator:n,value:o}=s;return{refs:t,mode:e,type:i,required:r,operator:n,value:o}}static valueOf({refs:t,mode:e,type:s,required:i,operator:r,value:n}){return new At(e,t,new je(s,i,n,r))}}class As{constructor(){this._=[],this.errors=new Map}getError(t,e){return this.errors.get(`${t}_${e}`)}validate(t,e,s){const i=this.get(t,e),r=`${t}_${e}`,{errors:n}=this;if(i!==null){const[o,h]=i.validator.validate(s);o?n.delete(r):n.set(r,h)}else n.delete(r);return!0}add(t,e,{type:s,required:i,value:r,operator:n}){const o=new je(s,i,r,n),h=this.getByValidator(o);h!==null?h.addRef(e):this._.push(new At(t,[e],o))}getByValidator(t){for(let e=0;e<this._.length;e+=1){const s=this._[e];if(s.validator.equals(t))return s}return null}get(t,e){for(let s=0;s<this._.length;s+=1){const i=this._[s];if(i.includes(t,e))return i}return null}remove(t){this.each(e=>{e.remove(t)})}each(t){this._.forEach(e=>t(e))}getData(){return this._.filter(t=>t.refs.length>0).map(t=>t.getData())}setData(t){this._=t.map(e=>At.valueOf(e))}}const zs={mode:"edit",view:{height:()=>document.documentElement.clientHeight,width:()=>document.documentElement.clientWidth},showGrid:!0,showToolbar:!0,showContextmenu:!0,showBottomBar:!0,row:{len:100,height:25},col:{len:26,width:100,indexWidth:60,minWidth:60},style:{bgcolor:"#ffffff",align:"left",valign:"middle",textwrap:!1,strike:!1,underline:!1,color:"#0a0a0a",font:{name:"Arial",size:10,bold:!1,italic:!1},format:"normal"}},Rs=41,Is=41,be=(l,t)=>Object.prototype.hasOwnProperty.call(l,t);function ve(l,t,e=()=>{}){const{merges:s}=this,i=t.clone(),[r,n]=l.size(),[o,h]=t.size();return r>o&&(i.eri=t.sri+r-1),n>h&&(i.eci=t.sci+n-1),s.intersects(i)?(e($("error.pasteForMergedCell")),!1):!0}function xe(l,t,e,s=!1){const{rows:i,merges:r}=this;(e==="all"||e==="format")&&(i.deleteCells(t,e),r.deleteWithin(t)),i.copyPaste(l,t,e,s,(n,o,h)=>{if(h&&h.merge){const[c,d]=h.merge;if(c<=0&&d<=0)return;r.add(new F(n,o,n+c,o+d))}})}function Ms(l,t){const{clipboard:e,rows:s,merges:i}=this;s.cutPaste(l,t),i.move(l,t.sri-l.sri,t.sci-l.sci),e.clear()}function rt(l,t,e){const{styles:s,rows:i}=this,r=i.getCellOrNew(l,t);let n={};r.style!==void 0&&(n=R.cloneDeep(s[r.style])),n=R.merge(n,{border:e}),r.style=this.addStyle(n)}function Hs({mode:l,style:t,color:e}){const{styles:s,selector:i,rows:r}=this,{sri:n,sci:o,eri:h,eci:c}=i.range,d=!this.isSignleSelected();if(!(!d&&(l==="inside"||l==="horizontal"||l==="vertical"))){if(l==="outside"&&!d)rt.call(this,n,o,{top:[t,e],bottom:[t,e],left:[t,e],right:[t,e]});else if(l==="none")i.range.each((a,f)=>{const g=r.getCell(a,f);if(g&&g.style!==void 0){const p=R.cloneDeep(s[g.style]);delete p.border,g.style=this.addStyle(p)}});else if(l==="all"||l==="inside"||l==="outside"||l==="horizontal"||l==="vertical"){const a=[];for(let f=n;f<=h;f+=1)for(let g=o;g<=c;g+=1){const p=[];for(let S=0;S<a.length;S+=1){const[A,z,T,it]=a[S];if(f===A+T+1&&p.push(S),A<=f&&f<=A+T&&g===z){g+=it+1;break}}if(p.forEach(S=>a.splice(S,1)),g>c)break;const w=r.getCell(f,g);let[b,v]=[0,0];w&&w.merge&&([b,v]=w.merge,a.push([f,g,b,v]));const C=b>0&&f+b===h,x=v>0&&g+v===c;let y={};l==="all"?y={bottom:[t,e],top:[t,e],left:[t,e],right:[t,e]}:l==="inside"?(!x&&g<c&&(y.right=[t,e]),!C&&f<h&&(y.bottom=[t,e])):l==="horizontal"?!C&&f<h&&(y.bottom=[t,e]):l==="vertical"?!x&&g<c&&(y.right=[t,e]):l==="outside"&&d&&(n===f&&(y.top=[t,e]),(C||h===f)&&(y.bottom=[t,e]),o===g&&(y.left=[t,e]),(x||c===g)&&(y.right=[t,e])),Object.keys(y).length>0&&rt.call(this,f,g,y),g+=v}}else if(l==="top"||l==="bottom")for(let a=o;a<=c;a+=1)l==="top"&&(rt.call(this,n,a,{top:[t,e]}),a+=r.getCellMerge(n,a)[1]),l==="bottom"&&(rt.call(this,h,a,{bottom:[t,e]}),a+=r.getCellMerge(h,a)[1]);else if(l==="left"||l==="right")for(let a=n;a<=h;a+=1)l==="left"&&(rt.call(this,a,o,{left:[t,e]}),a+=r.getCellMerge(a,o)[0]),l==="right"&&(rt.call(this,a,c,{right:[t,e]}),a+=r.getCellMerge(a,c)[0])}}function _s(l,t){const{rows:e}=this,s=this.freezeTotalHeight();let i=e.height;s+e.height<l&&(i-=t);const r=this.exceptRowSet;let n=0,o=i,{height:h}=e;for(;n<e.len&&!(o>l);n+=1)r.has(n)||(h=e.getHeight(n),o+=h);return o-=h,o<=0?{ri:-1,top:0,height:h}:{ri:n-1,top:o,height:h}}function Ws(l,t){const{cols:e}=this,s=this.freezeTotalWidth();let i=e.indexWidth;s+e.indexWidth<l&&(i-=t);const[r,n,o]=R.rangeReduceIf(0,e.len,i,e.indexWidth,l,h=>e.getWidth(h));return n<=0?{ci:-1,left:0,width:e.indexWidth}:{ci:r-1,left:n,width:o}}class Ps{constructor(t,e){this.settings=R.merge(zs,e||{}),this.name=t||"sheet",this.freeze=[0,0],this.styles=[],this.merges=new le,this.rows=new Ds(this.settings.row),this.cols=new Ts(this.settings.col),this.validations=new As,this.hyperlinks={},this.comments={},this.selector=new ms,this.scroll=new ws,this.history=new bs,this.clipboard=new vs,this.autoFilter=new xs,this.change=()=>{},this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map}addValidation(t,e,s){this.changeData(()=>{this.validations.add(t,e,s)})}removeValidation(){const{range:t}=this.selector;this.changeData(()=>{this.validations.remove(t)})}getSelectedValidator(){const{ri:t,ci:e}=this.selector,s=this.validations.get(t,e);return s?s.validator:null}getSelectedValidation(){const{ri:t,ci:e,range:s}=this.selector,i=this.validations.get(t,e),r={ref:s.toString()};return i!==null&&(r.mode=i.mode,r.validator=i.validator),r}canUndo(){return this.history.canUndo()}canRedo(){return this.history.canRedo()}undo(){this.history.undo(this.getData(),t=>{this.setData(t)})}redo(){this.history.redo(this.getData(),t=>{this.setData(t)})}copy(){this.clipboard.copy(this.selector.range)}copyToSystemClipboard(){if(navigator.clipboard===void 0)return;let t="";const e=this.rows.getData();for(let s=this.selector.range.sri;s<=this.selector.range.eri;s+=1){if(be(e,s)){for(let i=this.selector.range.sci;i<=this.selector.range.eci;i+=1)if(i>this.selector.range.sci&&(t+="	"),be(e[s].cells,i)){const r=String(e[s].cells[i].text);r.indexOf(`
`)===-1&&r.indexOf("	")===-1&&r.indexOf('"')===-1?t+=r:t+=`"${r}"`}}else for(let i=this.selector.range.sci;i<=this.selector.range.eci;i+=1)t+="	";t+=`
`}navigator.clipboard.writeText(t).then(()=>{},s=>{})}cut(){this.clipboard.cut(this.selector.range)}paste(t="all",e=()=>{}){const{clipboard:s,selector:i}=this;return s.isClear()||!ve.call(this,s.range,i.range,e)?!1:(this.changeData(()=>{s.isCopy()?xe.call(this,s.range,i.range,t):s.isCut()&&Ms.call(this,s.range,i.range)}),!0)}pasteFromText(t){const e=t.split(`\r
`).map(r=>r.replace(/"/g,"").split("	"));e.length>0&&(e.length-=1);const{rows:s,selector:i}=this;this.changeData(()=>{s.paste(e,i.range)})}autofill(t,e,s=()=>{}){const i=this.selector.range;return ve.call(this,i,t,s)?(this.changeData(()=>{xe.call(this,i,t,e,!0)}),!0):!1}clearClipboard(){this.clipboard.clear()}calSelectedRangeByEnd(t,e){const{selector:s,rows:i,cols:r,merges:n}=this;let{sri:o,sci:h,eri:c,eci:d}=s.range;const a=s.ri,f=s.ci;let[g,p]=[t,e];return t<0&&(g=i.len-1),e<0&&(p=r.len-1),g>a?[o,c]=[a,g]:[o,c]=[g,a],p>f?[h,d]=[f,p]:[h,d]=[p,f],s.range=n.union(new F(o,h,c,d)),s.range=n.union(s.range),s.range}calSelectedRangeByStart(t,e){const{selector:s,rows:i,cols:r,merges:n}=this;let o=n.getFirstIncludes(t,e);return o===null&&(o=new F(t,e,t,e),t===-1&&(o.sri=0,o.eri=i.len-1),e===-1&&(o.sci=0,o.eci=r.len-1)),s.range=o,o}setSelectedCellAttr(t,e){this.changeData(()=>{const{selector:s,styles:i,rows:r}=this;if(t==="merge")e?this.merge():this.unmerge();else if(t==="border")Hs.call(this,e);else if(t==="formula"){const{ri:n,ci:o,range:h}=s;if(s.multiple()){const[c,d]=s.size(),{sri:a,sci:f,eri:g,eci:p}=h;if(c>1)for(let w=f;w<=p;w+=1){const b=r.getCellOrNew(g+1,w);b.text=`=${e}(${q(w,a)}:${q(w,g)})`}else if(d>1){const w=r.getCellOrNew(n,p+1);w.text=`=${e}(${q(f,n)}:${q(p,n)})`}}else{const c=r.getCellOrNew(n,o);c.text=`=${e}()`}}else s.range.each((n,o)=>{const h=r.getCellOrNew(n,o);let c={};if(h.style!==void 0&&(c=R.cloneDeep(i[h.style])),t==="format")c.format=e,h.style=this.addStyle(c);else if(t==="font-bold"||t==="font-italic"||t==="font-name"||t==="font-size"){const d={};d[t.split("-")[1]]=e,c.font=Object.assign(c.font||{},d),h.style=this.addStyle(c)}else t==="strike"||t==="textwrap"||t==="underline"||t==="align"||t==="valign"||t==="color"||t==="bgcolor"?(c[t]=e,h.style=this.addStyle(c)):h[t]=e})})}setSelectedCellText(t,e="input"){const{autoFilter:s,selector:i,rows:r}=this,{ri:n,ci:o}=i;let h=n;this.unsortedRowMap.has(n)&&(h=this.unsortedRowMap.get(n));const c=r.getCell(h,o),d=c?c.text:"";if(this.setCellText(h,o,t,e),s.active()){const a=s.getFilter(o);if(a){const f=a.value.findIndex(g=>g===d);f>=0&&a.value.splice(f,1,t)}}}getSelectedCell(){const{ri:t,ci:e}=this.selector;let s=t;return this.unsortedRowMap.has(t)&&(s=this.unsortedRowMap.get(t)),this.rows.getCell(s,e)}xyInSelectedRect(t,e){const{left:s,top:i,width:r,height:n}=this.getSelectedRect(),o=t-this.cols.indexWidth,h=e-this.rows.height;return o>s&&o<s+r&&h>i&&h<i+n}getSelectedRect(){return this.getRect(this.selector.range)}getClipboardRect(){const{clipboard:t}=this;return t.isClear()?{left:-100,top:-100}:this.getRect(t.range)}getRect(t){const{scroll:e,rows:s,cols:i,exceptRowSet:r}=this,{sri:n,sci:o,eri:h,eci:c}=t;if(n<0&&o<0)return{left:0,l:0,top:0,t:0,scroll:e};const d=i.sumWidth(0,o),a=s.sumHeight(0,n,r),f=s.sumHeight(n,h+1,r),g=i.sumWidth(o,c+1);let p=d-e.x,w=a-e.y;const b=this.freezeTotalHeight(),v=this.freezeTotalWidth();return v>0&&v>d&&(p=d),b>0&&b>a&&(w=a),{l:d,t:a,left:p,top:w,height:f,width:g,scroll:e}}getCellRectByXY(t,e){const{scroll:s,merges:i,rows:r,cols:n}=this;let{ri:o,top:h,height:c}=_s.call(this,e,s.y),{ci:d,left:a,width:f}=Ws.call(this,t,s.x);if(d===-1&&(f=n.totalWidth()),o===-1&&(c=r.totalHeight()),o>=0||d>=0){const g=i.getFirstIncludes(o,d);g&&(o=g.sri,d=g.sci,{left:a,top:h,width:f,height:c}=this.cellRect(o,d))}return{ri:o,ci:d,left:a,top:h,width:f,height:c}}isSignleSelected(){const{sri:t,sci:e,eri:s,eci:i}=this.selector.range,r=this.getCell(t,e);if(r&&r.merge){const[n,o]=r.merge;if(t+n===s&&e+o===i)return!0}return!this.selector.multiple()}canUnmerge(){const{sri:t,sci:e,eri:s,eci:i}=this.selector.range,r=this.getCell(t,e);if(r&&r.merge){const[n,o]=r.merge;if(t+n===s&&e+o===i)return!0}return!1}merge(){const{selector:t,rows:e}=this;if(this.isSignleSelected())return;const[s,i]=t.size();if(s>1||i>1){const{sri:r,sci:n}=t.range;this.changeData(()=>{const o=e.getCellOrNew(r,n);o.merge=[s-1,i-1],this.merges.add(t.range),this.rows.deleteCells(t.range),this.rows.setCell(r,n,o)})}}unmerge(){const{selector:t}=this;if(!this.isSignleSelected())return;const{sri:e,sci:s}=t.range;this.changeData(()=>{this.rows.deleteCell(e,s,"merge"),this.merges.deleteWithin(t.range)})}canAutofilter(){return!this.autoFilter.active()}autofilter(){const{autoFilter:t,selector:e}=this;this.changeData(()=>{t.active()?(t.clear(),this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map):t.ref=e.range.toString()})}setAutoFilter(t,e,s,i){const{autoFilter:r}=this;r.addFilter(t,s,i),r.setSort(t,e),this.resetAutoFilter()}resetAutoFilter(){const{autoFilter:t,rows:e}=this;if(!t.active())return;const{sort:s}=t,{rset:i,fset:r}=t.filteredRows((h,c)=>e.getCell(h,c)),n=Array.from(r),o=Array.from(r);s&&n.sort((h,c)=>s.order==="asc"?h-c:s.order==="desc"?c-h:0),this.exceptRowSet=i,this.sortedRowMap=new Map,this.unsortedRowMap=new Map,n.forEach((h,c)=>{this.sortedRowMap.set(o[c],h),this.unsortedRowMap.set(h,o[c])})}deleteCell(t="all"){const{selector:e}=this;this.changeData(()=>{this.rows.deleteCells(e.range,t),(t==="all"||t==="format")&&this.merges.deleteWithin(e.range)})}insert(t,e=1){this.changeData(()=>{const{sri:s,sci:i}=this.selector.range,{rows:r,merges:n,cols:o}=this;let h=s;t==="row"?r.insert(s,e):t==="column"&&(r.insertColumn(i,e),h=i,o.len+=1),n.shift(t,h,e,(c,d,a,f)=>{const g=r.getCell(c,d);g.merge[0]+=a,g.merge[1]+=f})})}delete(t){this.changeData(()=>{const{rows:e,merges:s,selector:i,cols:r}=this,{range:n}=i,{sri:o,sci:h,eri:c,eci:d}=i.range,[a,f]=i.range.size();let g=o,p=a;t==="row"?e.delete(o,c):t==="column"&&(e.deleteColumn(h,d),g=n.sci,p=f,r.len-=1),s.shift(t,g,-p,(w,b,v,C)=>{const x=e.getCell(w,b);x.merge[0]+=v,x.merge[1]+=C,x.merge[0]===0&&x.merge[1]===0&&delete x.merge})})}scrollx(t,e){const{scroll:s,freeze:i,cols:r}=this,[,n]=i,[o,h,c]=R.rangeReduceIf(n,r.len,0,0,t,a=>r.getWidth(a));let d=h;t>0&&(d+=c),s.x!==d&&(s.ci=t>0?o:0,s.x=d,e())}scrolly(t,e){const{scroll:s,freeze:i,rows:r}=this,[n]=i,[o,h,c]=R.rangeReduceIf(n,r.len,0,0,t,a=>r.getHeight(a));let d=h;t>0&&(d+=c),s.y!==d&&(s.ri=t>0?o:0,s.y=d,e())}cellRect(t,e){const{rows:s,cols:i}=this,r=i.sumWidth(0,e),n=s.sumHeight(0,t),o=s.getCell(t,e);let h=i.getWidth(e),c=s.getHeight(t);if(o!==null&&o.merge){const[d,a]=o.merge;if(d>0)for(let f=1;f<=d;f+=1)c+=s.getHeight(t+f);if(a>0)for(let f=1;f<=a;f+=1)h+=i.getWidth(e+f)}return{left:r,top:n,width:h,height:c,cell:o}}getCell(t,e){return this.rows.getCell(t,e)}getCellTextOrDefault(t,e){const s=this.getCell(t,e);return s&&s.text?s.text:""}getCellStyle(t,e){const s=this.getCell(t,e);return s&&s.style!==void 0?this.styles[s.style]:null}getCellStyleOrDefault(t,e){const{styles:s,rows:i}=this,r=i.getCell(t,e),n=r&&r.style!==void 0?s[r.style]:{};return R.merge(this.defaultStyle(),n)}getSelectedCellStyle(){const{ri:t,ci:e}=this.selector;return this.getCellStyleOrDefault(t,e)}setCellText(t,e,s,i){const{rows:r,history:n,validations:o}=this;i==="finished"?(r.setCellText(t,e,""),n.add(this.getData()),r.setCellText(t,e,s)):(r.setCellText(t,e,s),this.change(this.getData())),o.validate(t,e,s)}freezeIsActive(){const[t,e]=this.freeze;return t>0||e>0}setFreeze(t,e){this.changeData(()=>{this.freeze=[t,e]})}freezeTotalWidth(){return this.cols.sumWidth(0,this.freeze[1])}freezeTotalHeight(){return this.rows.sumHeight(0,this.freeze[0])}setRowHeight(t,e){this.changeData(()=>{this.rows.setHeight(t,e)})}setColWidth(t,e){this.changeData(()=>{this.cols.setWidth(t,e)})}viewHeight(){const{view:t,showToolbar:e,showBottomBar:s}=this.settings;let i=t.height();return s&&(i-=Is),e&&(i-=Rs),i}viewWidth(){return this.settings.view.width()}freezeViewRange(){const[t,e]=this.freeze;return new F(0,0,t-1,e-1,this.freezeTotalWidth(),this.freezeTotalHeight())}contentRange(){const{rows:t,cols:e}=this,[s,i]=t.maxCell(),r=t.sumHeight(0,s+1),n=e.sumWidth(0,i+1);return new F(0,0,s,i,n,r)}exceptRowTotalHeight(t,e){const{exceptRowSet:s,rows:i}=this,r=Array.from(s);let n=0;return r.forEach(o=>{if(o<t||o>e){const h=i.getHeight(o);n+=h}}),n}viewRange(){const{scroll:t,rows:e,cols:s,freeze:i,exceptRowSet:r}=this;let{ri:n,ci:o}=t;n<=0&&([n]=i),o<=0&&([,o]=i);let[h,c]=[0,0],[d,a]=[e.len,s.len];for(let f=n;f<e.len&&(r.has(f)||(c+=e.getHeight(f),d=f),!(c>this.viewHeight()));f+=1);for(let f=o;f<s.len&&(h+=s.getWidth(f),a=f,!(h>this.viewWidth()));f+=1);return new F(n,o,d,a,h,c)}eachMergesInView(t,e){this.merges.filterIntersects(t).forEach(s=>e(s))}hideRowsOrCols(){const{rows:t,cols:e,selector:s}=this,[i,r]=s.size(),{sri:n,sci:o,eri:h,eci:c}=s.range;if(i===t.len)for(let d=o;d<=c;d+=1)e.setHide(d,!0);else if(r===e.len)for(let d=n;d<=h;d+=1)t.setHide(d,!0)}unhideRowsOrCols(t,e){this[`${t}s`].unhide(e)}rowEach(t,e,s){let i=0;const{rows:r}=this,n=this.exceptRowSet,o=[...n];let h=0;for(let c=0;c<o.length;c+=1)o[c]<t&&(h+=1);for(let c=t+h;c<=e+h;c+=1)if(n.has(c))h+=1;else{const d=r.getHeight(c);if(d>0&&(s(c,i,d),i+=d,i>this.viewHeight()))break}}colEach(t,e,s){let i=0;const{cols:r}=this;for(let n=t;n<=e;n+=1){const o=r.getWidth(n);if(o>0&&(s(n,i,o),i+=o,i>this.viewWidth()))break}}defaultStyle(){return this.settings.style}addStyle(t){const{styles:e}=this;for(let s=0;s<e.length;s+=1){const i=e[s];if(R.equals(i,t))return s}return e.push(t),e.length-1}changeData(t){this.history.add(this.getData()),t(),this.change(this.getData())}setData(t){return Object.keys(t).forEach(e=>{if(e==="merges"||e==="rows"||e==="cols"||e==="validations")this[e].setData(t[e]);else if(e==="freeze"){const[s,i]=K(t[e]);this.freeze=[i,s]}else e==="autofilter"?this.autoFilter.setData(t[e]):t[e]!==void 0&&(this[e]=t[e])}),this}getData(){const{name:t,freeze:e,styles:s,merges:i,rows:r,cols:n,validations:o,autoFilter:h}=this;return{name:t,freeze:q(e[1],e[0]),styles:s,merges:i.getData(),rows:r.getData(),cols:n.getData(),validations:o.getData(),autofilter:h.getData()}}}function M(l,t,e){l.addEventListener(t,e)}function zt(l,t,e){l.removeEventListener(t,e)}function at(l){l.xclickoutside&&(zt(window.document.body,"click",l.xclickoutside),delete l.xclickoutside)}function mt(l,t){l.xclickoutside=e=>{e.detail===2||l.contains(e.target)||(t?t(l):(l.hide(),at(l)))},M(window.document.body,"click",l.xclickoutside)}function Ue(l,t,e){M(l,"mousemove",t);const s=l;s.xEvtUp=i=>{zt(l,"mousemove",t),zt(l,"mouseup",l.xEvtUp),e(i)},M(l,"mouseup",l.xEvtUp)}function ye(l,t,e,s){let i="";Math.abs(l)>Math.abs(t)?(i=l>0?"right":"left",s(i,l,e)):(i=t>0?"down":"up",s(i,t,e))}function Ns(l,{move:t,end:e}){let s=0,i=0;M(l,"touchstart",r=>{const{pageX:n,pageY:o}=r.touches[0];s=n,i=o}),M(l,"touchmove",r=>{if(!t)return;const{pageX:n,pageY:o}=r.changedTouches[0],h=n-s,c=o-i;(Math.abs(h)>10||Math.abs(c)>10)&&(ye(h,c,r,t),s=n,i=o),r.preventDefault()}),M(l,"touchend",r=>{if(!e)return;const{pageX:n,pageY:o}=r.changedTouches[0],h=n-s,c=o-i;ye(h,c,r,e)})}function Bs(){const l=new Map;function t(n,o){const h=()=>{const d=l.get(n);return Array.isArray(d)&&d.push(o)||!1},c=()=>l.set(n,[].concat(o));return l.has(n)&&h()||c()}function e(n,o){const h=()=>{const c=l.get(n);for(const d of c)d.call(null,...o)};return l.has(n)&&h()}function s(n,o){const h=()=>{const c=l.get(n),d=c.indexOf(o);return d>=0&&c.splice(d,1)&&l.get(n).length===0&&l.delete(n)};return l.has(n)&&h()}function i(n,o){const h=(...c)=>{o.call(null,...c),s(n,h)};return t(n,h)}function r(){l.clear()}return{get current(){return l},on:t,once:i,fire:e,removeListener:s,removeAllListeners:r}}const m="x-spreadsheet";class Ce{constructor(t=!1,e){this.moving=!1,this.vertical=t,this.el=u("div",`${m}-resizer ${t?"vertical":"horizontal"}`).children(this.unhideHoverEl=u("div",`${m}-resizer-hover`).on("dblclick.stop",s=>this.mousedblclickHandler(s)).css("position","absolute").hide(),this.hoverEl=u("div",`${m}-resizer-hover`).on("mousedown.stop",s=>this.mousedownHandler(s)),this.lineEl=u("div",`${m}-resizer-line`).hide()).hide(),this.cRect=null,this.finishedFn=null,this.minDistance=e,this.unhideFn=()=>{}}showUnhide(t){this.unhideIndex=t,this.unhideHoverEl.show()}hideUnhide(){this.unhideHoverEl.hide()}show(t,e){const{moving:s,vertical:i,hoverEl:r,lineEl:n,el:o,unhideHoverEl:h}=this;if(s)return;this.cRect=t;const{left:c,top:d,width:a,height:f}=t;o.offset({left:i?c+a-5:c,top:i?d:d+f-5}).show(),r.offset({width:i?5:a,height:i?f:5}),n.offset({width:i?0:e.width,height:i?e.height:0}),h.offset({left:i?5-a:c,top:i?d:5-f,width:i?5:a,height:i?f:5})}hide(){this.el.offset({left:0,top:0}).hide(),this.hideUnhide()}mousedblclickHandler(){this.unhideIndex&&this.unhideFn(this.unhideIndex)}mousedownHandler(t){let e=t;const{el:s,lineEl:i,cRect:r,vertical:n,minDistance:o}=this;let h=n?r.width:r.height;i.show(),Ue(window,c=>{this.moving=!0,e!==null&&c.buttons===1&&(n?(h+=c.movementX,h>o&&s.css("left",`${r.left+h}px`)):(h+=c.movementY,h>o&&s.css("top",`${r.top+h}px`)),e=c)},()=>{e=null,i.hide(),this.moving=!1,this.hide(),this.finishedFn&&(h<o&&(h=o),this.finishedFn(r,h))})}}class ke{constructor(t){this.vertical=t,this.moveFn=null,this.el=u("div",`${m}-scrollbar ${t?"vertical":"horizontal"}`).child(this.contentEl=u("div","")).on("mousemove.stop",()=>{}).on("scroll.stop",e=>{const{scrollTop:s,scrollLeft:i}=e.target;this.moveFn&&this.moveFn(this.vertical?s:i,e)})}move(t){return this.el.scroll(t),this}scroll(){return this.el.scroll()}set(t,e){const s=t-1;if(e>s){const i=this.vertical?"height":"width";this.el.css(i,`${s-15}px`).show(),this.contentEl.css(this.vertical?"width":"height","1px").css(i,`${e}px`)}else this.el.hide();return this}}const vt=2*2-1;let Gt=10;class xt{constructor(t=!1){this.useHideInput=t,this.inputChange=()=>{},this.cornerEl=u("div",`${m}-selector-corner`),this.areaEl=u("div",`${m}-selector-area`).child(this.cornerEl).hide(),this.clipboardEl=u("div",`${m}-selector-clipboard`).hide(),this.autofillEl=u("div",`${m}-selector-autofill`).hide(),this.el=u("div",`${m}-selector`).css("z-index",`${Gt}`).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),t&&(this.hideInput=u("input","").on("compositionend",e=>{this.inputChange(e.target.value)}),this.el.child(this.hideInputDiv=u("div","hide-input").child(this.hideInput)),this.el.child(this.hideInputDiv=u("div","hide-input").child(this.hideInput))),Gt+=1}setOffset(t){return this.el.offset(t).show(),this}hide(){return this.el.hide(),this}setAreaOffset(t){const{left:e,top:s,width:i,height:r}=t,n={width:i-vt+.8,height:r-vt+.8,left:e-.8,top:s-.8};this.areaEl.offset(n).show(),this.useHideInput&&(this.hideInputDiv.offset(n),this.hideInput.val("").focus())}setClipboardOffset(t){const{left:e,top:s,width:i,height:r}=t;this.clipboardEl.offset({left:e,top:s,width:i-5,height:r-5})}showAutofill(t){const{left:e,top:s,width:i,height:r}=t;this.autofillEl.offset({width:i-vt,height:r-vt,left:e,top:s}).show()}hideAutofill(){this.autofillEl.hide()}showClipboard(){this.clipboardEl.show()}hideClipboard(){this.clipboardEl.hide()}}function re(l){const{data:t}=this,{left:e,top:s,width:i,height:r,scroll:n,l:o,t:h}=l,c=t.freezeTotalWidth(),d=t.freezeTotalHeight();let a=e-c;c>o&&(a-=n.x);let f=s-d;return d>h&&(f-=n.y),{left:a,top:f,width:i,height:r}}function ne(l){const{data:t}=this,{left:e,width:s,height:i,l:r,t:n,scroll:o}=l,h=t.freezeTotalWidth();let c=e-h;return h>r&&(c-=o.x),{left:c,top:n,width:s,height:i}}function oe(l){const{data:t}=this,{top:e,width:s,height:i,l:r,t:n,scroll:o}=l,h=t.freezeTotalHeight();let c=e-h;return h>n&&(c-=o.y),{left:r,top:c,width:s,height:i}}function Qt(l){const{br:t}=this;t.setAreaOffset(re.call(this,l))}function Vs(l){const{tl:t}=this;t.setAreaOffset(l)}function Xe(l){const{t}=this;t.setAreaOffset(ne.call(this,l))}function Ke(l){const{l:t}=this;t.setAreaOffset(oe.call(this,l))}function Ze(l){const{l:t}=this;t.setClipboardOffset(oe.call(this,l))}function te(l){const{br:t}=this;t.setClipboardOffset(re.call(this,l))}function Ls(l){const{tl:t}=this;t.setClipboardOffset(l)}function Je(l){const{t}=this;t.setClipboardOffset(ne.call(this,l))}function Ee(l){Qt.call(this,l),Vs.call(this,l),Xe.call(this,l),Ke.call(this,l)}function Se(l){te.call(this,l),Ls.call(this,l),Je.call(this,l),Ze.call(this,l)}class qs{constructor(t){this.inputChange=()=>{},this.data=t,this.br=new xt(!0),this.t=new xt,this.l=new xt,this.tl=new xt,this.br.inputChange=e=>{this.inputChange(e)},this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.range=null,this.arange=null,this.el=u("div",`${m}-selectors`).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),this.lastri=-1,this.lastci=-1,Gt+=1}resetData(t){this.data=t,this.range=t.selector.range,this.resetAreaOffset()}hide(){this.el.hide()}resetOffset(){const{data:t,tl:e,t:s,l:i,br:r}=this,n=t.freezeTotalHeight(),o=t.freezeTotalWidth();n>0||o>0?(e.setOffset({width:o,height:n}),s.setOffset({left:o,height:n}),i.setOffset({top:n,width:o}),r.setOffset({left:o,top:n})):(e.hide(),s.hide(),i.hide(),r.setOffset({left:0,top:0}))}resetAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();Ee.call(this,t),Se.call(this,e),this.resetOffset()}resetBRTAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();Qt.call(this,t),Xe.call(this,t),te.call(this,e),Je.call(this,e),this.resetOffset()}resetBRLAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();Qt.call(this,t),Ke.call(this,t),te.call(this,e),Ze.call(this,e),this.resetOffset()}set(t,e,s=!0){const{data:i}=this,r=i.calSelectedRangeByStart(t,e),{sri:n,sci:o}=r;if(s){let[h,c]=[t,e];t<0&&(h=0),e<0&&(c=0),i.selector.setIndexes(h,c),this.indexes=[h,c]}this.moveIndexes=[n,o],this.range=r,this.resetAreaOffset(),this.el.show()}setEnd(t,e,s=!0){const{data:i,lastri:r,lastci:n}=this;if(s){if(t===r&&e===n)return;this.lastri=t,this.lastci=e}this.range=i.calSelectedRangeByEnd(t,e),Ee.call(this,this.data.getSelectedRect())}reset(){const{eri:t,eci:e}=this.data.selector.range;this.setEnd(t,e)}showAutofill(t,e){if(t===-1&&e===-1)return;const{sri:s,sci:i,eri:r,eci:n}=this.range,[o,h]=[t,e],c=s-t,d=i-e,a=r-t,f=n-e;if(d>0)this.arange=new F(s,h,r,i-1);else if(c>0)this.arange=new F(o,i,s-1,n);else if(f<0)this.arange=new F(s,n+1,r,h);else if(a<0)this.arange=new F(r+1,i,o,n);else{this.arange=null;return}if(this.arange!==null){const g=this.data.getRect(this.arange);g.width+=2,g.height+=2;const{br:p,l:w,t:b,tl:v}=this;p.showAutofill(re.call(this,g)),w.showAutofill(oe.call(this,g)),b.showAutofill(ne.call(this,g)),v.showAutofill(g)}}hideAutofill(){["br","l","t","tl"].forEach(t=>{this[t].hideAutofill()})}showClipboard(){const t=this.data.getClipboardRect();Se.call(this,t),["br","l","t","tl"].forEach(e=>{this[e].showClipboard()})}hideClipboard(){["br","l","t","tl"].forEach(t=>{this[t].hideClipboard()})}}function Ys(l){l.preventDefault(),l.stopPropagation();const{filterItems:t}=this;t.length<=0||(this.itemIndex>=0&&t[this.itemIndex].toggle(),this.itemIndex-=1,this.itemIndex<0&&(this.itemIndex=t.length-1),t[this.itemIndex].toggle())}function js(l){l.stopPropagation();const{filterItems:t}=this;t.length<=0||(this.itemIndex>=0&&t[this.itemIndex].toggle(),this.itemIndex+=1,this.itemIndex>t.length-1&&(this.itemIndex=0),t[this.itemIndex].toggle())}function Fe(l){l.preventDefault();const{filterItems:t}=this;t.length<=0||(l.stopPropagation(),this.itemIndex<0&&(this.itemIndex=0),t[this.itemIndex].el.click(),this.hide())}function Us(l){const{keyCode:t}=l;switch(l.ctrlKey&&l.stopPropagation(),t){case 37:l.stopPropagation();break;case 38:Ys.call(this,l);break;case 39:l.stopPropagation();break;case 40:js.call(this,l);break;case 13:Fe.call(this,l);break;case 9:Fe.call(this,l);break;default:l.stopPropagation();break}}class Ge{constructor(t,e,s="200px"){this.filterItems=[],this.items=t,this.el=u("div",`${m}-suggest`).css("width",s).hide(),this.itemClick=e,this.itemIndex=-1}setOffset(t){this.el.cssRemoveKeys("top","bottom").offset(t)}hide(){const{el:t}=this;this.filterItems=[],this.itemIndex=-1,t.hide(),at(this.el.parent())}setItems(t){this.items=t}search(t){let{items:e}=this;if(/^\s*$/.test(t)||(e=e.filter(i=>(i.key||i).startsWith(t.toUpperCase()))),e=e.map(i=>{let{title:r}=i;r?typeof r=="function"&&(r=r()):r=i;const n=u("div",`${m}-item`).child(r).on("click.stop",()=>{this.itemClick(i),this.hide()});return i.label&&n.child(u("div","label").html(i.label)),n}),this.filterItems=e,e.length<=0)return;const{el:s}=this;s.html("").children(...e).show(),mt(s.parent(),()=>{this.hide()})}bindInputEvents(t){t.on("keydown",e=>Us.call(this,e))}}class D extends st{constructor(t){super("div",`${m}-icon`),this.iconNameEl=u("div",`${m}-icon-img ${t}`),this.child(this.iconNameEl)}setName(t){this.iconNameEl.className(`${m}-icon-img ${t}`)}}function $e(l,t){l.setMonth(l.getMonth()+t)}function Xs(l,t){const e=new Date(l);return e.setDate(t-l.getDay()+1),e}function Ks(l,t,e){const s=new Date(l,t,1,23,59,59),i=[[],[],[],[],[],[]];for(let r=0;r<6;r+=1)for(let n=0;n<7;n+=1){const o=r*7+n,h=Xs(s,o),c=h.getMonth()!==t,d=h.getMonth()===e.getMonth()&&h.getDate()===e.getDate();i[r][n]={d:h,disabled:c,active:d}}return i}class Zs{constructor(t){this.value=t,this.cvalue=new Date(t),this.headerLeftEl=u("div","calendar-header-left"),this.bodyEl=u("tbody",""),this.buildAll(),this.el=u("div","x-spreadsheet-calendar").children(u("div","calendar-header").children(this.headerLeftEl,u("div","calendar-header-right").children(u("a","calendar-prev").on("click.stop",()=>this.prev()).child(new D("chevron-left")),u("a","calendar-next").on("click.stop",()=>this.next()).child(new D("chevron-right")))),u("table","calendar-body").children(u("thead","").child(u("tr","").children(...$("calendar.weeks").map(e=>u("th","cell").child(e)))),this.bodyEl)),this.selectChange=()=>{}}setValue(t){this.value=t,this.cvalue=new Date(t),this.buildAll()}prev(){const{value:t}=this;$e(t,-1),this.buildAll()}next(){const{value:t}=this;$e(t,1),this.buildAll()}buildAll(){this.buildHeaderLeft(),this.buildBody()}buildHeaderLeft(){const{value:t}=this;this.headerLeftEl.html(`${$("calendar.months")[t.getMonth()]} ${t.getFullYear()}`)}buildBody(){const{value:t,cvalue:e,bodyEl:s}=this,r=Ks(t.getFullYear(),t.getMonth(),e).map(n=>{const o=n.map(h=>{let c="cell";return h.disabled&&(c+=" disabled"),h.active&&(c+=" active"),u("td","").child(u("div",c).on("click.stop",()=>{this.selectChange(h.d)}).child(h.d.getDate().toString()))});return u("tr","").children(...o)});s.html("").children(...r)}}class Js{constructor(){this.calendar=new Zs(new Date),this.el=u("div",`${m}-datepicker`).child(this.calendar.el).hide()}setValue(t){const{calendar:e}=this;return typeof t=="string"?/^\d{4}-\d{1,2}-\d{1,2}$/.test(t)&&e.setValue(new Date(t.replace(new RegExp("-","g"),"/"))):t instanceof Date&&e.setValue(t),this}change(t){this.calendar.selectChange=e=>{t(e),this.hide()}}show(){this.el.show()}hide(){this.el.hide()}}function Rt(){const{inputText:l}=this;if(!/^\s*$/.test(l)){const{textlineEl:t,textEl:e,areaOffset:s}=this,i=l.split(`
`),r=Math.max(...i.map(a=>a.length)),o=t.offset().width/l.length,h=(r+1)*o+5,c=this.viewFn().width-s.left-o;let d=i.length;if(h>s.width){let a=h;h>c&&(a=c,d+=parseInt(h/c,10),d+=h%c>0?1:0),e.css("width",`${a}px`)}d*=this.rowHeight,d>s.height&&e.css("height",`${d}px`)}}function Gs({target:l},t){const{value:e,selectionEnd:s}=l,i=`${e.slice(0,s)}${t}${e.slice(s)}`;l.value=i,l.setSelectionRange(s+1,s+1),this.inputText=i,this.textlineEl.html(i),Rt.call(this)}function Qs(l){const{keyCode:t,altKey:e}=l;t!==13&&t!==9&&l.stopPropagation(),t===13&&e&&(Gs.call(this,l,`
`),l.stopPropagation()),t===13&&!e&&l.preventDefault()}function ti(l){const t=l.target.value,{suggest:e,textlineEl:s,validator:i}=this,{cell:r}=this;if(r!==null)if("editable"in r&&r.editable===!0||r.editable===void 0){if(this.inputText=t,i)i.type==="list"?e.search(t):e.hide();else{const n=t.lastIndexOf("=");n!==-1?e.search(t.substring(n+1)):e.hide()}s.html(t),Rt.call(this),this.change("input",t)}else l.target.value=r.text;else{if(this.inputText=t,i)i.type==="list"?e.search(t):e.hide();else{const n=t.lastIndexOf("=");n!==-1?e.search(t.substring(n+1)):e.hide()}s.html(t),Rt.call(this),this.change("input",t)}}function ei(l){const{el:t}=this.textEl;setTimeout(()=>{t.focus(),t.setSelectionRange(l,l)},0)}function Qe(l,t){const{textEl:e,textlineEl:s}=this;e.el.blur(),e.val(l),s.html(l),ei.call(this,t)}function si(l){const{inputText:t,validator:e}=this;let s=0;if(e&&e.type==="list")this.inputText=l,s=this.inputText.length;else{const i=t.lastIndexOf("="),r=t.substring(0,i+1);let n=t.substring(i+1);n.indexOf(")")!==-1?n=n.substring(n.indexOf(")")):n="",this.inputText=`${r+l.key}(`,s=this.inputText.length,this.inputText+=`)${n}`}Qe.call(this,this.inputText,s)}function ii(){this.suggest.setItems(this.formulas)}function li(l){let t=l.getMonth()+1,e=l.getDate();return t<10&&(t=`0${t}`),e<10&&(e=`0${e}`),`${l.getFullYear()}-${t}-${e}`}class ri{constructor(t,e,s){this.viewFn=e,this.rowHeight=s,this.formulas=t,this.suggest=new Ge(t,i=>{si.call(this,i)}),this.datepicker=new Js,this.datepicker.change(i=>{this.setText(li(i)),this.clear()}),this.areaEl=u("div",`${m}-editor-area`).children(this.textEl=u("textarea","").on("input",i=>ti.call(this,i)).on("paste.stop",()=>{}).on("keydown",i=>Qs.call(this,i)),this.textlineEl=u("div","textline"),this.suggest.el,this.datepicker.el).on("mousemove.stop",()=>{}).on("mousedown.stop",()=>{}),this.el=u("div",`${m}-editor`).child(this.areaEl).hide(),this.suggest.bindInputEvents(this.textEl),this.areaOffset=null,this.freeze={w:0,h:0},this.cell=null,this.inputText="",this.change=()=>{}}setFreezeLengths(t,e){this.freeze.w=t,this.freeze.h=e}clear(){this.inputText!==""&&this.change("finished",this.inputText),this.cell=null,this.areaOffset=null,this.inputText="",this.el.hide(),this.textEl.val(""),this.textlineEl.html(""),ii.call(this),this.datepicker.hide()}setOffset(t,e="top"){const{textEl:s,areaEl:i,suggest:r,freeze:n,el:o}=this;if(t){this.areaOffset=t;const{left:h,top:c,width:d,height:a,l:f,t:g}=t,p={left:0,top:0};n.w>f&&n.h>g||(n.w<f&&n.h<g?(p.left=n.w,p.top=n.h):n.w>f?p.top=n.h:n.h>g&&(p.left=n.w)),o.offset(p),i.offset({left:h-p.left-.8,top:c-p.top-.8}),s.offset({width:d-9+.8,height:a-3+.8});const w={left:0};w[e]=a,r.setOffset(w),r.hide()}}setCell(t,e){const{el:s,datepicker:i,suggest:r}=this;s.show(),this.cell=t;const n=t&&t.text||"";if(this.setText(n),this.validator=e,e){const{type:o}=e;o==="date"&&(i.show(),/^\s*$/.test(n)||i.setValue(n)),o==="list"&&(r.setItems(e.values()),r.search(""))}}setText(t){this.inputText=t,Qe.call(this,t,t.length),Rt.call(this)}}class tt extends st{constructor(t,e=""){super("div",`${m}-button ${e}`),this.child($(`button.${t}`))}}function It(){return window.devicePixelRatio||1}function he(){return It()-.5}function k(l){return parseInt(l*It(),10)}function nt(l){const t=k(l);return t>0?t-.5:.5}class ni{constructor(t,e,s,i,r=0){this.x=t,this.y=e,this.width=s,this.height=i,this.padding=r,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}setBorders({top:t,bottom:e,left:s,right:i}){t&&(this.borderTop=t),i&&(this.borderRight=i),e&&(this.borderBottom=e),s&&(this.borderLeft=s)}innerWidth(){return this.width-this.padding*2-2}innerHeight(){return this.height-this.padding*2-2}textx(t){const{width:e,padding:s}=this;let{x:i}=this;return t==="left"?i+=s:t==="center"?i+=e/2:t==="right"&&(i+=e-s),i}texty(t,e){const{height:s,padding:i}=this;let{y:r}=this;return t==="top"?r+=i:t==="middle"?r+=s/2-e/2:t==="bottom"&&(r+=s-i-e),r}topxys(){const{x:t,y:e,width:s}=this;return[[t,e],[t+s,e]]}rightxys(){const{x:t,y:e,width:s,height:i}=this;return[[t+s,e],[t+s,e+i]]}bottomxys(){const{x:t,y:e,width:s,height:i}=this;return[[t,e+i],[t+s,e+i]]}leftxys(){const{x:t,y:e,height:s}=this;return[[t,e],[t,e+s]]}}function De(l,t,e,s,i,r,n){const o={x:0,y:0};l==="underline"?i==="bottom"?o.y=0:i==="top"?o.y=-(r+2):o.y=-r/2:l==="strike"&&(i==="bottom"?o.y=r/2:i==="top"&&(o.y=-(r/2+2))),s==="center"?o.x=n/2:s==="right"&&(o.x=n),this.line([t-o.x,e-o.y],[t-o.x+n,e-o.y])}class ts{constructor(t,e,s){this.el=t,this.ctx=t.getContext("2d"),this.resize(e,s),this.ctx.scale(It(),It())}resize(t,e){this.el.style.width=`${t}px`,this.el.style.height=`${e}px`,this.el.width=k(t),this.el.height=k(e)}clear(){const{width:t,height:e}=this.el;return this.ctx.clearRect(0,0,t,e),this}attr(t){return Object.assign(this.ctx,t),this}save(){return this.ctx.save(),this.ctx.beginPath(),this}restore(){return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}translate(t,e){return this.ctx.translate(k(t),k(e)),this}scale(t,e){return this.ctx.scale(t,e),this}clearRect(t,e,s,i){return this.ctx.clearRect(t,e,s,i),this}fillRect(t,e,s,i){return this.ctx.fillRect(k(t)-.5,k(e)-.5,k(s),k(i)),this}fillText(t,e,s){return this.ctx.fillText(t,k(e),k(s)),this}text(t,e,s={},i=!0){const{ctx:r}=this,{align:n,valign:o,font:h,color:c,strike:d,underline:a}=s,f=e.textx(n);r.save(),r.beginPath(),this.attr({textAlign:n,textBaseline:o,font:`${h.italic?"italic":""} ${h.bold?"bold":""} ${k(h.size)}px ${h.name}`,fillStyle:c,strokeStyle:c});const g=`${t}`.split(`
`),p=e.innerWidth(),w=[];g.forEach(C=>{const x=r.measureText(C).width;if(i&&x>k(p)){let y={w:0,len:0,start:0};for(let S=0;S<C.length;S+=1)y.w>=k(p)&&(w.push(C.substr(y.start,y.len)),y={w:0,len:0,start:S}),y.len+=1,y.w+=r.measureText(C[S]).width+1;y.len>0&&w.push(C.substr(y.start,y.len))}else w.push(C)});const b=(w.length-1)*(h.size+2);let v=e.texty(o,b);return w.forEach(C=>{const x=r.measureText(C).width;this.fillText(C,f,v),d&&De.call(this,"strike",f,v,n,o,h.size,x),a&&De.call(this,"underline",f,v,n,o,h.size,x),v+=h.size+2}),r.restore(),this}border(t,e){const{ctx:s}=this;return s.lineWidth=he,s.strokeStyle=e,t==="medium"?s.lineWidth=k(2)-.5:t==="thick"?s.lineWidth=k(3):t==="dashed"?s.setLineDash([k(3),k(2)]):t==="dotted"?s.setLineDash([k(1),k(1)]):t==="double"&&s.setLineDash([k(2),0]),this}line(...t){const{ctx:e}=this;if(t.length>1){e.beginPath();const[s,i]=t[0];e.moveTo(nt(s),nt(i));for(let r=1;r<t.length;r+=1){const[n,o]=t[r];e.lineTo(nt(n),nt(o))}e.stroke()}return this}strokeBorders(t){const{ctx:e}=this;e.save();const{borderTop:s,borderRight:i,borderBottom:r,borderLeft:n}=t;s&&(this.border(...s),this.line(...t.topxys())),i&&(this.border(...i),this.line(...t.rightxys())),r&&(this.border(...r),this.line(...t.bottomxys())),n&&(this.border(...n),this.line(...t.leftxys())),e.restore()}dropdown(t){const{ctx:e}=this,{x:s,y:i,width:r,height:n}=t,o=s+r-15,h=i+n-15;e.save(),e.beginPath(),e.moveTo(k(o),k(h)),e.lineTo(k(o+8),k(h)),e.lineTo(k(o+4),k(h+6)),e.closePath(),e.fillStyle="rgba(0, 0, 0, .45)",e.fill(),e.restore()}error(t){const{ctx:e}=this,{x:s,y:i,width:r}=t,n=s+r-1;e.save(),e.beginPath(),e.moveTo(k(n-8),k(i-1)),e.lineTo(k(n),k(i-1)),e.lineTo(k(n),k(i+8)),e.closePath(),e.fillStyle="rgba(255, 0, 0, .65)",e.fill(),e.restore()}frozen(t){const{ctx:e}=this,{x:s,y:i,width:r}=t,n=s+r-1;e.save(),e.beginPath(),e.moveTo(k(n-8),k(i-1)),e.lineTo(k(n),k(i-1)),e.lineTo(k(n),k(i+8)),e.closePath(),e.fillStyle="rgba(0, 255, 0, .85)",e.fill(),e.restore()}rect(t,e){const{ctx:s}=this,{x:i,y:r,width:n,height:o,bgcolor:h}=t;s.save(),s.beginPath(),s.fillStyle=h||"#fff",s.rect(nt(i+1),nt(r+1),k(n-2),k(o-2)),s.clip(),s.fill(),e(),s.restore()}}const Te=[{key:"Arial",title:"Arial"},{key:"Helvetica",title:"Helvetica"},{key:"Source Sans Pro",title:"Source Sans Pro"},{key:"Comic Sans MS",title:"Comic Sans MS"},{key:"Courier New",title:"Courier New"},{key:"Verdana",title:"Verdana"},{key:"Lato",title:"Lato"}],ee=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},{pt:42,px:56}];function oi(l){for(let t=0;t<ee.length;t+=1){const e=ee[t];if(e.pt===l)return e.px}return l}const hi=l=>{const t=[],e=[];let s=[],i=0,r="",n=1,o="";for(let h=0;h<l.length;h+=1){const c=l.charAt(h);if(c!==" "){if(c>="a"&&c<="z")s.push(c.toUpperCase());else if(c>="0"&&c<="9"||c>="A"&&c<="Z"||c===".")s.push(c);else if(c==='"'){for(h+=1;l.charAt(h)!=='"';)s.push(l.charAt(h)),h+=1;e.push(`"${s.join("")}`),s=[]}else if(c==="-"&&/[+\-*/,(]/.test(o))s.push(c);else{if(c!=="("&&s.length>0&&e.push(s.join("")),c===")"){let d=t.pop();if(i===2)try{const[a,f]=K(e.pop()),[g,p]=K(e.pop());let w=0;for(let b=g;b<=a;b+=1)for(let v=p;v<=f;v+=1)e.push(q(b,v)),w+=1;e.push([d,w])}catch{}else if(i===1||i===3)i===3&&e.push(r),e.push([d,n]),n=1;else for(;d!=="("&&(e.push(d),!(t.length<=0));)d=t.pop();i=0}else if(c==="="||c===">"||c==="<"){const d=l.charAt(h+1);r=c,(d==="="||d==="-")&&(r+=d,h+=1),i=3}else if(c===":")i=2;else if(c===",")i===3&&e.push(r),i=1,n+=1;else if(c==="("&&s.length>0)t.push(s.join(""));else{if(t.length>0&&(c==="+"||c==="-")){let d=t[t.length-1];if(d!=="("&&e.push(t.pop()),d==="*"||d==="/")for(;t.length>0&&(d=t[t.length-1],d!=="(");)e.push(t.pop())}else if(t.length>0){const d=t[t.length-1];(d==="*"||d==="/")&&e.push(t.pop())}t.push(c)}s=[]}o=c}}for(s.length>0&&e.push(s.join(""));t.length>0;)e.push(t.pop());return e},ci=(l,t)=>{const[e]=l;let s=l;if(e==='"')return l.substring(1);let i=1;if(e==="-"&&(s=l.substring(1),i=-1),s[0]>="0"&&s[0]<="9")return i*Number(s);const[r,n]=K(s);return i*t(r,n)},ai=(l,t,e,s)=>{const i=[];for(let r=0;r<l.length;r+=1){const n=l[r],o=n[0];if(n==="+"){const h=i.pop();i.push(Q("+",i.pop(),h))}else if(n==="-")if(i.length===1){const h=i.pop();i.push(Q("*",h,-1))}else{const h=i.pop();i.push(Q("-",i.pop(),h))}else if(n==="*")i.push(Q("*",i.pop(),i.pop()));else if(n==="/"){const h=i.pop();i.push(Q("/",i.pop(),h))}else if(o==="="||o===">"||o==="<"){let h=i.pop();Number.isNaN(h)||(h=Number(h));let c=i.pop();Number.isNaN(c)||(c=Number(c));let d=!1;o==="="?d=c===h:n===">"?d=c>h:n===">="?d=c>=h:n==="<"?d=c<h:n==="<="&&(d=c<=h),i.push(d)}else if(Array.isArray(n)){const[h,c]=n,d=[];for(let a=0;a<c;a+=1)d.push(i.pop());i.push(t[h].render(d.reverse()))}else{if(s.includes(n))return 0;(o>="a"&&o<="z"||o>="A"&&o<="Z")&&s.push(n),i.push(ci(n,e)),s.pop()}}return i[0]},es=(l,t,e,s=[])=>{if(l[0]==="="){const i=hi(l.substring(1));return i.length<=0?l:ai(i,t,(r,n)=>es(e(r,n),t,e,s),s)}return l},di={render:es},ce=[{key:"SUM",title:E("formula.sum"),render:l=>l.reduce((t,e)=>Q("+",t,e),0)},{key:"AVERAGE",title:E("formula.average"),render:l=>l.reduce((t,e)=>Number(t)+Number(e),0)/l.length},{key:"MAX",title:E("formula.max"),render:l=>Math.max(...l.map(t=>Number(t)))},{key:"MIN",title:E("formula.min"),render:l=>Math.min(...l.map(t=>Number(t)))},{key:"IF",title:E("formula._if"),render:([l,t,e])=>l?t:e},{key:"AND",title:E("formula.and"),render:l=>l.every(t=>t)},{key:"OR",title:E("formula.or"),render:l=>l.some(t=>t)},{key:"CONCAT",title:E("formula.concat"),render:l=>l.join("")}],fi=ce,ss={};ce.forEach(l=>{ss[l.key]=l});const ot=l=>l,yt=l=>{if(/^(-?\d*.?\d*)$/.test(l)){const t=Number(l).toFixed(2).toString(),[e,...s]=t.split("\\.");return[e.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),...s]}return l},ut=[{key:"normal",title:E("format.normal"),type:"string",render:ot},{key:"text",title:E("format.text"),type:"string",render:ot},{key:"number",title:E("format.number"),type:"number",label:"1,000.12",render:yt},{key:"percent",title:E("format.percent"),type:"number",label:"10.12%",render:l=>`${l}%`},{key:"rmb",title:E("format.rmb"),type:"number",label:"￥10.00",render:l=>`￥${yt(l)}`},{key:"usd",title:E("format.usd"),type:"number",label:"$10.00",render:l=>`$${yt(l)}`},{key:"eur",title:E("format.eur"),type:"number",label:"€10.00",render:l=>`€${yt(l)}`},{key:"date",title:E("format.date"),type:"date",label:"26/09/2008",render:ot},{key:"time",title:E("format.time"),type:"date",label:"15:59:00",render:ot},{key:"datetime",title:E("format.datetime"),type:"date",label:"26/09/2008 15:59:00",render:ot},{key:"duration",title:E("format.duration"),type:"date",label:"24:01:00",render:ot}],is={};ut.forEach(l=>{is[l.key]=l});const ui=5,gi={fillStyle:"#f4f5f8"},pi={fillStyle:"#fff",lineWidth:he,strokeStyle:"#e6e6e6"};function mi(){return{textAlign:"center",textBaseline:"middle",font:`500 ${k(12)}px Source Sans Pro`,fillStyle:"#585757",lineWidth:he(),strokeStyle:"#e6e6e6"}}function ls(l,t,e,s=0){const{left:i,top:r,width:n,height:o}=l.cellRect(t,e);return new ni(i,r+s,n,o,ui)}function Mt(l,t,e,s,i=0){const{sortedRowMap:r,rows:n,cols:o}=t;if(n.isHide(e)||o.isHide(s))return;let h=e;r.has(e)&&(h=r.get(e));const c=t.getCell(h,s);if(c===null)return;let d=!1;"editable"in c&&c.editable===!1&&(d=!0);const a=t.getCellStyleOrDefault(h,s),f=ls(t,e,s,i);f.bgcolor=a.bgcolor,a.border!==void 0&&(f.setBorders(a.border),l.strokeBorders(f)),l.rect(f,()=>{let g="";t.settings.evalPaused?g=c.text||"":g=di.render(c.text||"",ss,(b,v)=>t.getCellTextOrDefault(v,b)),a.format&&(g=is[a.format].render(g));const p=Object.assign({},a.font);p.size=oi(p.size),l.text(g,f,{align:a.align,valign:a.valign,font:p,color:a.color,strike:a.strike,underline:a.underline},a.textwrap),t.validations.getError(e,s)&&l.error(f),d&&l.frozen(f)})}function wi(l){const{data:t,draw:e}=this;if(l){const{autoFilter:s}=t;if(!s.active())return;const i=s.hrange();l.intersects(i)&&i.each((r,n)=>{const o=ls(t,r,n);e.dropdown(o)})}}function Ct(l,t,e,s,i){const{draw:r,data:n}=this;r.save(),r.translate(t,e).translate(s,i);const{exceptRowSet:o}=n,h=a=>{const f=o.has(a);if(f){const g=n.rows.getHeight(a);r.translate(0,-g)}return!f},c=n.exceptRowTotalHeight(l.sri,l.eri);r.save(),r.translate(0,-c),l.each((a,f)=>{Mt(r,n,a,f)},a=>h(a)),r.restore();const d=new Set;r.save(),r.translate(0,-c),n.eachMergesInView(l,({sri:a,sci:f,eri:g})=>{if(!o.has(a))Mt(r,n,a,f);else if(!d.has(a)){d.add(a);const p=n.rows.sumHeight(a,g+1);r.translate(0,-p)}}),r.restore(),wi.call(this,l),r.restore()}function Oe(l,t,e,s){const{draw:i}=this;i.save(),i.attr({fillStyle:"rgba(75, 137, 255, 0.08)"}).fillRect(l,t,e,s),i.restore()}function kt(l,t,e,s,i,r){const{draw:n,data:o}=this,h=t.h,c=t.w,d=r+s,a=i+e;n.save(),n.attr(gi),(l==="all"||l==="left")&&n.fillRect(0,d,e,h),(l==="all"||l==="top")&&n.fillRect(a,0,c,s);const{sri:f,sci:g,eri:p,eci:w}=o.selector.range;n.attr(mi()),(l==="all"||l==="left")&&(o.rowEach(t.sri,t.eri,(b,v,C)=>{const x=d+v,y=b;n.line([0,x],[e,x]),f<=y&&y<p+1&&Oe.call(this,0,x,e,C),n.fillText(y+1,e/2,x+C/2),b>0&&o.rows.isHide(b-1)&&(n.save(),n.attr({strokeStyle:"#c6c6c6"}),n.line([5,x+5],[e-5,x+5]),n.restore())}),n.line([0,h+d],[e,h+d]),n.line([e,d],[e,h+d])),(l==="all"||l==="top")&&(o.colEach(t.sci,t.eci,(b,v,C)=>{const x=a+v,y=b;n.line([x,0],[x,s]),g<=y&&y<w+1&&Oe.call(this,x,0,C,s),n.fillText(Ve(y),x+C/2,s/2),b>0&&o.cols.isHide(b-1)&&(n.save(),n.attr({strokeStyle:"#c6c6c6"}),n.line([x+5,5],[x+5,s-5]),n.restore())}),n.line([c+a,0],[c+a,s]),n.line([0,s],[c+a,s])),n.restore()}function bi(l,t){const{draw:e}=this;e.save(),e.attr({fillStyle:"#f4f5f8"}).fillRect(0,0,l,t),e.restore()}function Et({sri:l,sci:t,eri:e,eci:s,w:i,h:r},n,o,h,c){const{draw:d,data:a}=this,{settings:f}=a;if(d.save(),d.attr(pi).translate(n+h,o+c),!f.showGrid){d.restore();return}a.rowEach(l,e,(g,p,w)=>{g!==l&&d.line([0,p],[i,p]),g===e&&d.line([0,p+w],[i,p+w])}),a.colEach(t,s,(g,p,w)=>{g!==t&&d.line([p,0],[p,r]),g===s&&d.line([p+w,0],[p+w,r])}),d.restore()}function vi(l,t,e,s){const{draw:i,data:r}=this,n=r.viewWidth()-l,o=r.viewHeight()-t;i.save().translate(l,t).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),i.line([0,s],[n,s]),i.line([e,0],[e,o]),i.restore()}class xi{constructor(t,e){this.el=t,this.draw=new ts(t,e.viewWidth(),e.viewHeight()),this.data=e}resetData(t){this.data=t,this.render()}render(){const{data:t}=this,{rows:e,cols:s}=t,i=s.indexWidth,r=e.height;this.draw.resize(t.viewWidth(),t.viewHeight()),this.clear();const n=t.viewRange(),o=t.freezeTotalWidth(),h=t.freezeTotalHeight(),{x:c,y:d}=t.scroll;Et.call(this,n,i,r,o,h),Ct.call(this,n,i,r,-c,-d),kt.call(this,"all",n,i,r,o,h),bi.call(this,i,r);const[a,f]=t.freeze;if(a>0||f>0){if(a>0){const p=n.clone();p.sri=0,p.eri=a-1,p.h=h,Et.call(this,p,i,r,o,0),Ct.call(this,p,i,r,-c,0),kt.call(this,"top",p,i,r,o,0)}if(f>0){const p=n.clone();p.sci=0,p.eci=f-1,p.w=o,Et.call(this,p,i,r,0,h),kt.call(this,"left",p,i,r,0,h),Ct.call(this,p,i,r,0,-d)}const g=t.freezeViewRange();Et.call(this,g,i,r,0,0),kt.call(this,"all",g,i,r,0,0),Ct.call(this,g,i,r,0,0),vi.call(this,i,r,o,h)}}clear(){this.draw.clear()}}const Ft=[["A3",11.69,16.54],["A4",8.27,11.69],["A5",5.83,8.27],["B4",9.84,13.9],["B5",6.93,9.84]],se=["landscape","portrait"];function Ht(l){return parseInt(96*l,10)}function Ae(l){l==="cancel"?this.el.hide():this.toPrint()}function yi(l){const{paper:t}=this,{value:e}=l.target,s=Ft[e];t.w=Ht(s[1]),t.h=Ht(s[2]),this.preview()}function Ci(l){const{paper:t}=this,{value:e}=l.target,s=se[e];t.orientation=s,this.preview()}let ki=class{constructor(t){this.paper={w:Ht(Ft[0][1]),h:Ht(Ft[0][2]),padding:50,orientation:se[0],get width(){return this.orientation==="landscape"?this.h:this.w},get height(){return this.orientation==="landscape"?this.w:this.h}},this.data=t,this.el=u("div",`${m}-print`).children(u("div",`${m}-print-bar`).children(u("div","-title").child("Print settings"),u("div","-right").children(u("div",`${m}-buttons`).children(new tt("cancel").on("click",Ae.bind(this,"cancel")),new tt("next","primary").on("click",Ae.bind(this,"next"))))),u("div",`${m}-print-content`).children(this.contentEl=u("div","-content"),u("div","-sider").child(u("form","").children(u("fieldset","").children(u("label","").child(`${$("print.size")}`),u("select","").children(...Ft.map((e,s)=>u("option","").attr("value",s).child(`${e[0]} ( ${e[1]}''x${e[2]}'' )`))).on("change",yi.bind(this))),u("fieldset","").children(u("label","").child(`${$("print.orientation")}`),u("select","").children(...se.map((e,s)=>u("option","").attr("value",s).child(`${$("print.orientations")[s]}`))).on("change",Ci.bind(this))))))).hide()}resetData(t){this.data=t}preview(){const{data:t,paper:e}=this,{width:s,height:i,padding:r}=e,n=s-r*2,o=i-r*2,h=t.contentRange(),c=parseInt(h.h/o,10)+1,d=n/h.w;let a=r;const f=r;d>1&&(a+=(n-h.w)/2);let g=0,p=0;this.contentEl.html(""),this.canvases=[];const w={sri:0,sci:0,eri:0,eci:0};for(let b=0;b<c;b+=1){let v=0,C=0;const x=u("div",`${m}-canvas-card`),y=u("canvas",`${m}-canvas`);this.canvases.push(y.el);const S=new ts(y.el,s,i);for(S.save(),S.translate(a,f),d<1&&S.scale(d,d);g<=h.eri;g+=1){const z=t.rows.getHeight(g);if(v+=z,v<o)for(let T=0;T<=h.eci;T+=1)Mt(S,t,g,T,p),w.eci=T;else{C=-(v-z);break}}w.eri=g,S.restore(),S.save(),S.translate(a,f),d<1&&S.scale(d,d);const A=p;t.eachMergesInView(w,({sri:z,sci:T})=>{Mt(S,t,z,T,A)}),S.restore(),w.sri=w.eri,w.sci=w.eci,p+=C,this.contentEl.child(u("div",`${m}-canvas-card-wraper`).child(x.child(y)))}this.el.show()}toPrint(){this.el.hide();const{paper:t}=this,e=u("iframe","").hide(),{el:s}=e;window.document.body.appendChild(s);const{contentWindow:i}=s,r=i.document,n=document.createElement("style");n.innerHTML=`
      @page { size: ${t.width}px ${t.height}px; };
      canvas {
        page-break-before: auto;        
        page-break-after: always;
        image-rendering: pixelated;
      };
    `,r.head.appendChild(n),this.canvases.forEach(o=>{const h=o.cloneNode(!1);h.getContext("2d").drawImage(o,0,0),r.body.appendChild(h)}),i.print()}};const Ei=[{key:"copy",title:E("contextmenu.copy"),label:"Ctrl+C"},{key:"cut",title:E("contextmenu.cut"),label:"Ctrl+X"},{key:"paste",title:E("contextmenu.paste"),label:"Ctrl+V"},{key:"paste-value",title:E("contextmenu.pasteValue"),label:"Ctrl+Shift+V"},{key:"paste-format",title:E("contextmenu.pasteFormat"),label:"Ctrl+Alt+V"},{key:"divider"},{key:"insert-row",title:E("contextmenu.insertRow")},{key:"insert-column",title:E("contextmenu.insertColumn")},{key:"divider"},{key:"delete-row",title:E("contextmenu.deleteRow")},{key:"delete-column",title:E("contextmenu.deleteColumn")},{key:"delete-cell-text",title:E("contextmenu.deleteCellText")},{key:"hide",title:E("contextmenu.hide")},{key:"divider"},{key:"validation",title:E("contextmenu.validation")},{key:"divider"},{key:"cell-printable",title:E("contextmenu.cellprintable")},{key:"cell-non-printable",title:E("contextmenu.cellnonprintable")},{key:"divider"},{key:"cell-editable",title:E("contextmenu.celleditable")},{key:"cell-non-editable",title:E("contextmenu.cellnoneditable")}];function Si(l){return l.key==="divider"?u("div",`${m}-item divider`):u("div",`${m}-item`).on("click",()=>{this.itemClick(l.key),this.hide()}).children(l.title(),u("div","label").child(l.label||""))}function Fi(){return Ei.map(l=>Si.call(this,l))}let $i=class{constructor(t,e=!1){this.menuItems=Fi.call(this),this.el=u("div",`${m}-contextmenu`).children(...this.menuItems).hide(),this.viewFn=t,this.itemClick=()=>{},this.isHide=e,this.setMode("range")}setMode(t){const e=this.menuItems[12];t==="row-col"?e.show():e.hide()}hide(){const{el:t}=this;t.hide(),at(t)}setPosition(t,e){if(this.isHide)return;const{el:s}=this,{width:i}=s.show().offset(),r=this.viewFn(),n=r.height/2;let o=t;r.width-t<=i&&(o-=i),s.css("left",`${o}px`),e>n?s.css("bottom",`${r.height-e}px`).css("max-height",`${e}px`).css("top","auto"):s.css("top",`${e}px`).css("max-height",`${r.height-e}px`).css("bottom","auto"),mt(s)}};function Di(l,t){if(t.classList.contains("active"))return;const{left:e,top:s,width:i,height:r}=t.getBoundingClientRect(),n=u("div",`${m}-tooltip`).html(l).show();document.body.appendChild(n.el);const o=n.box();n.css("left",`${e+i/2-o.width/2}px`).css("top",`${s+r+2}px`),M(t,"mouseleave",()=>{document.body.contains(n.el)&&document.body.removeChild(n.el)}),M(t,"click",()=>{document.body.contains(n.el)&&document.body.removeChild(n.el)})}class ae{constructor(t,e,s){this.tip=$(`toolbar.${t.replace(/-[a-z]/g,i=>i[1].toUpperCase())}`),e&&(this.tip+=` (${e})`),this.tag=t,this.shortcut=e,this.value=s,this.el=this.element(),this.change=()=>{}}element(){const{tip:t}=this;return u("div",`${m}-toolbar-btn`).on("mouseenter",e=>{Di(t,e.target)}).attr("data-tooltip",t)}setState(){}}class V extends ae{dropdown(){}getValue(t){return t}element(){const{tag:t}=this;return this.dd=this.dropdown(),this.dd.change=e=>this.change(t,this.getValue(e)),super.element().child(this.dd)}setState(t){t&&(this.value=t,this.dd.setTitle(t))}}class L extends st{constructor(t,e,s,i,...r){super("div",`${m}-dropdown ${i}`),this.title=t,this.change=()=>{},this.headerClick=()=>{},typeof t=="string"?this.title=u("div",`${m}-dropdown-title`).child(t):s&&this.title.addClass("arrow-left"),this.contentEl=u("div",`${m}-dropdown-content`).css("width",e).hide(),this.setContentChildren(...r),this.headerEl=u("div",`${m}-dropdown-header`),this.headerEl.on("click",()=>{this.contentEl.css("display")!=="block"?this.show():this.hide()}).children(this.title,s?u("div",`${m}-icon arrow-right`).child(u("div",`${m}-icon-img arrow-down`)):""),this.children(this.headerEl,this.contentEl)}setContentChildren(...t){this.contentEl.html(""),t.length>0&&this.contentEl.children(...t)}setTitle(t){this.title.html(t),this.hide()}show(){const{contentEl:t}=this;t.show(),this.parent().active(),mt(this.parent(),()=>{this.hide()})}hide(){this.parent().active(!1),this.contentEl.hide(),at(this.parent())}}function Ti(l){return u("div",`${m}-item`).child(new D(l))}class rs extends L{constructor(t,e){const s=new D(`align-${e}`),i=t.map(r=>Ti(`align-${r}`).on("click",()=>{this.setTitle(r),this.change(r)}));super(s,"auto",!0,"bottom-left",...i)}setTitle(t){this.title.setName(`align-${t}`),this.hide()}}class Oi extends V{constructor(t){super("align","",t)}dropdown(){const{value:t}=this;return new rs(["left","center","right"],t)}}class Ai extends V{constructor(t){super("valign","",t)}dropdown(){const{value:t}=this;return new rs(["top","middle","bottom"],t)}}class Y extends ae{element(){const{tag:t}=this;return super.element().child(new D(t)).on("click",()=>this.click())}click(){this.change(this.tag,this.toggle())}setState(t){this.el.active(t)}toggle(){return this.el.toggle()}active(){return this.el.hasClass("active")}}class zi extends Y{constructor(){super("autofilter")}setState(){}}class Ri extends Y{constructor(){super("font-bold","Ctrl+B")}}class Ii extends Y{constructor(){super("font-italic","Ctrl+I")}}class Mi extends Y{constructor(){super("strike","Ctrl+U")}}class Hi extends Y{constructor(){super("underline","Ctrl+U")}}const _i=["#ffffff","#000100","#e7e5e6","#445569","#5b9cd6","#ed7d31","#a5a5a5","#ffc001","#4371c6","#71ae47"],Wi=[["#f2f2f2","#7f7f7f","#d0cecf","#d5dce4","#deeaf6","#fce5d5","#ededed","#fff2cd","#d9e2f3","#e3efd9"],["#d8d8d8","#595959","#afabac","#adb8ca","#bdd7ee","#f7ccac","#dbdbdb","#ffe59a","#b3c6e7","#c5e0b3"],["#bfbfbf","#3f3f3f","#756f6f","#8596b0","#9cc2e6","#f4b184","#c9c9c9","#fed964","#8eaada","#a7d08c"],["#a5a5a5","#262626","#3a3839","#333f4f","#2e75b5","#c45a10","#7b7b7b","#bf8e01","#2f5596","#538136"],["#7f7f7f","#0c0c0c","#171516","#222a35","#1f4e7a","#843c0a","#525252","#7e6000","#203864","#365624"]],Pi=["#c00000","#fe0000","#fdc101","#ffff01","#93d051","#00b04e","#01b0f1","#0170c1","#012060","#7030a0"];function Nt(l){return u("td","").child(u("div",`${m}-color-palette-cell`).on("click.stop",()=>this.change(l)).css("background-color",l))}class Ni{constructor(){this.el=u("div",`${m}-color-palette`),this.change=()=>{};const t=u("table","").children(u("tbody","").children(u("tr",`${m}-theme-color-placeholders`).children(..._i.map(e=>Nt.call(this,e))),...Wi.map(e=>u("tr",`${m}-theme-colors`).children(...e.map(s=>Nt.call(this,s)))),u("tr",`${m}-standard-colors`).children(...Pi.map(e=>Nt.call(this,e)))));this.el.child(t)}}class de extends L{constructor(t,e){const s=new D(t).css("height","16px").css("border-bottom",`3px solid ${e}`),i=new Ni;i.change=r=>{this.setTitle(r),this.change(r)},super(s,"auto",!1,"bottom-left",i.el)}setTitle(t){this.title.css("border-color",t),this.hide()}}const Bi=[["thin",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" style="user-select: none;"></line></svg>'],["medium",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="2" style="user-select: none;"><line x1="0" y1="1.0" x2="50" y2="1.0" stroke-width="2" stroke="black" style="user-select: none;"></line></svg>'],["thick",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="3" style="user-select: none;"><line x1="0" y1="1.5" x2="50" y2="1.5" stroke-width="3" stroke="black" style="user-select: none;"></line></svg>'],["dashed",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="2" style="user-select: none;"></line></svg>'],["dotted",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="1" style="user-select: none;"></line></svg>']];class Vi extends L{constructor(t){const e=new D("line-type");let s=0;const i=Bi.map((r,n)=>u("div",`${m}-item state ${t===r[0]?"checked":""}`).on("click",()=>{i[s].toggle("checked"),i[n].toggle("checked"),s=n,this.hide(),this.change(r)}).child(u("div",`${m}-line-type`).html(r[1])));super(e,"auto",!1,"bottom-left",...i)}}function ze(...l){return u("table","").child(u("tbody","").children(...l))}function Re(l){return u("td","").child(u("div",`${m}-border-palette-cell`).child(new D(`border-${l}`)).on("click",()=>{this.mode=l;const{mode:t,style:e,color:s}=this;this.change({mode:t,style:e,color:s})}))}class Li{constructor(){this.color="#000",this.style="thin",this.mode="all",this.change=()=>{},this.ddColor=new de("line-color",this.color),this.ddColor.change=e=>{this.color=e},this.ddType=new Vi(this.style),this.ddType.change=([e])=>{this.style=e},this.el=u("div",`${m}-border-palette`);const t=ze(u("tr","").children(u("td",`${m}-border-palette-left`).child(ze(u("tr","").children(...["all","inside","horizontal","vertical","outside"].map(e=>Re.call(this,e))),u("tr","").children(...["left","top","right","bottom","none"].map(e=>Re.call(this,e))))),u("td",`${m}-border-palette-right`).children(u("div",`${m}-toolbar-btn`).child(this.ddColor.el),u("div",`${m}-toolbar-btn`).child(this.ddType.el))));this.el.child(t)}}class qi extends L{constructor(){const t=new D("border-all"),e=new Li;e.change=s=>{this.change(s),this.hide()},super(t,"auto",!1,"bottom-left",e.el)}}class Yi extends V{constructor(){super("border")}dropdown(){return new qi}}class Wt extends ae{element(){return super.element().child(new D(this.tag)).on("click",()=>this.change(this.tag))}setState(t){this.el.disabled(t)}}class ji extends Wt{constructor(){super("clearformat")}}class Ui extends Y{constructor(){super("paintformat")}setState(){}}class Xi extends V{constructor(t){super("color",void 0,t)}dropdown(){const{tag:t,value:e}=this;return new de(t,e)}}class Ki extends V{constructor(t){super("bgcolor",void 0,t)}dropdown(){const{tag:t,value:e}=this;return new de(t,e)}}class Zi extends L{constructor(){const t=ee.map(e=>u("div",`${m}-item`).on("click",()=>{this.setTitle(`${e.pt}`),this.change(e)}).child(`${e.pt}`));super("10","60px",!0,"bottom-left",...t)}}let Ji=class extends V{constructor(){super("font-size")}getValue(t){return t.pt}dropdown(){return new Zi}};class Gi extends L{constructor(){const t=Te.map(e=>u("div",`${m}-item`).on("click",()=>{this.setTitle(e.title),this.change(e)}).child(e.title));super(Te[0].title,"160px",!0,"bottom-left",...t)}}class Qi extends V{constructor(){super("font-name")}getValue(t){return t.key}dropdown(){return new Gi}}class tl extends L{constructor(){let t=ut.slice(0);t.splice(2,0,{key:"divider"}),t.splice(8,0,{key:"divider"}),t=t.map(e=>{const s=u("div",`${m}-item`);return e.key==="divider"?s.addClass("divider"):(s.child(e.title()).on("click",()=>{this.setTitle(e.title()),this.change(e)}),e.label&&s.child(u("div","label").html(e.label))),s}),super("Normal","220px",!0,"bottom-left",...t)}setTitle(t){for(let e=0;e<ut.length;e+=1)ut[e].key===t&&this.title.html(ut[e].title());this.hide()}}let el=class extends V{constructor(){super("format")}getValue(t){return t.key}dropdown(){return new tl}};class sl extends L{constructor(){const t=ce.map(e=>u("div",`${m}-item`).on("click",()=>{this.hide(),this.change(e)}).child(e.key));super(new D("formula"),"180px",!0,"bottom-left",...t)}}class il extends V{constructor(){super("formula")}getValue(t){return t.key}dropdown(){return new sl}}class ll extends Y{constructor(){super("freeze")}}class rl extends Y{constructor(){super("merge")}setState(t,e){this.el.active(t).disabled(e)}}class nl extends Wt{constructor(){super("redo","Ctrl+Y")}}class ol extends Wt{constructor(){super("undo","Ctrl+Z")}}class hl extends Wt{constructor(){super("print","Ctrl+P")}}class cl extends Y{constructor(){super("textwrap")}}let al=class extends L{constructor(){const t=new D("ellipsis"),e=u("div",`${m}-toolbar-more`);super(t,"auto",!1,"bottom-right",e),this.moreBtns=e,this.contentEl.css("max-width","420px")}};class dl extends V{constructor(){super("more"),this.el.hide()}dropdown(){return new al}show(){this.el.show()}hide(){this.el.hide()}}function ht(){return u("div",`${m}-toolbar-divider`)}function fl(){this.btns2=[],this.items.forEach(l=>{if(Array.isArray(l))l.forEach(({el:t})=>{const e=t.box(),{marginLeft:s,marginRight:i}=t.computedStyle();this.btns2.push([t,e.width+parseInt(s,10)+parseInt(i,10)])});else{const t=l.box(),{marginLeft:e,marginRight:s}=l.computedStyle();this.btns2.push([l,t.width+parseInt(e,10)+parseInt(s,10)])}})}function Ie(){const{el:l,btns:t,moreEl:e,btns2:s}=this,{moreBtns:i,contentEl:r}=e.dd;l.css("width",`${this.widthFn()-60}px`);const n=l.box();let o=160,h=12;const c=[],d=[];s.forEach(([a,f],g)=>{o+=f,g===s.length-1||o<n.width?c.push(a):(h+=f,d.push(a))}),t.html("").children(...c),i.html("").children(...d),r.css("width",`${h}px`),d.length>0?e.show():e.hide()}class ul{constructor(t,e,s=!1){this.data=t,this.change=()=>{},this.widthFn=e,this.isHide=s;const i=t.defaultStyle();this.items=[[this.undoEl=new ol,this.redoEl=new nl,new hl,this.paintformatEl=new Ui,this.clearformatEl=new ji],ht(),[this.formatEl=new el],ht(),[this.fontEl=new Qi,this.fontSizeEl=new Ji],ht(),[this.boldEl=new Ri,this.italicEl=new Ii,this.underlineEl=new Hi,this.strikeEl=new Mi,this.textColorEl=new Xi(i.color)],ht(),[this.fillColorEl=new Ki(i.bgcolor),this.borderEl=new Yi,this.mergeEl=new rl],ht(),[this.alignEl=new Oi(i.align),this.valignEl=new Ai(i.valign),this.textwrapEl=new cl],ht(),[this.freezeEl=new ll,this.autofilterEl=new zi,this.formulaEl=new il,this.moreEl=new dl]],this.el=u("div",`${m}-toolbar`),this.btns=u("div",`${m}-toolbar-btns`),this.items.forEach(r=>{Array.isArray(r)?r.forEach(n=>{this.btns.child(n.el),n.change=(...o)=>{this.change(...o)}}):this.btns.child(r.el)}),this.el.child(this.btns),s?this.el.hide():(this.reset(),setTimeout(()=>{fl.call(this),Ie.call(this)},0),M(window,"resize",()=>{Ie.call(this)}))}paintformatActive(){return this.paintformatEl.active()}paintformatToggle(){this.paintformatEl.toggle()}trigger(t){this[`${t}El`].click()}resetData(t){this.data=t,this.reset()}reset(){if(this.isHide)return;const{data:t}=this,e=t.getSelectedCellStyle();this.undoEl.setState(!t.canUndo()),this.redoEl.setState(!t.canRedo()),this.mergeEl.setState(t.canUnmerge(),!t.selector.multiple()),this.autofilterEl.setState(!t.canAutofilter());const{font:s,format:i}=e;this.formatEl.setState(i),this.fontEl.setState(s.name),this.fontSizeEl.setState(s.size),this.boldEl.setState(s.bold),this.italicEl.setState(s.italic),this.underlineEl.setState(e.underline),this.strikeEl.setState(e.strike),this.textColorEl.setState(e.color),this.fillColorEl.setState(e.bgcolor),this.alignEl.setState(e.align),this.valignEl.setState(e.valign),this.textwrapEl.setState(e.textwrap),this.freezeEl.setState(t.freezeIsActive())}}class gl{constructor(t,e,s="600px"){this.title=t,this.el=u("div",`${m}-modal`).css("width",s).children(u("div",`${m}-modal-header`).children(new D("close").on("click.stop",()=>this.hide()),this.title),u("div",`${m}-modal-content`).children(...e)).hide()}show(){this.dimmer=u("div",`${m}-dimmer active`),document.body.appendChild(this.dimmer.el);const{width:t,height:e}=this.el.show().box(),{clientHeight:s,clientWidth:i}=document.documentElement;this.el.offset({left:(i-t)/2,top:(s-e)/3}),window.xkeydownEsc=r=>{r.keyCode===27&&this.hide()},M(window,"keydown",window.xkeydownEsc)}hide(){this.el.hide(),document.body.removeChild(this.dimmer.el),zt(window,"keydown",window.xkeydownEsc),delete window.xkeydownEsc}}class ct{constructor(t,e){this.vchange=()=>{},this.el=u("div",`${m}-form-input`),this.input=u("input","").css("width",t).on("input",s=>this.vchange(s)).attr("placeholder",e),this.el.child(this.input)}focus(){setTimeout(()=>{this.input.el.focus()},10)}hint(t){this.input.attr("placeholder",t)}val(t){return this.input.val(t)}}class Bt{constructor(t,e,s,i=n=>n,r=()=>{}){this.key=t,this.getTitle=i,this.vchange=()=>{},this.el=u("div",`${m}-form-select`),this.suggest=new Ge(e.map(n=>({key:n,title:this.getTitle(n)})),n=>{this.itemClick(n.key),r(n.key),this.vchange(n.key)},s,this.el),this.el.children(this.itemEl=u("div","input-text").html(this.getTitle(t)),this.suggest.el).on("click",()=>this.show())}show(){this.suggest.search("")}itemClick(t){this.key=t,this.itemEl.html(this.getTitle(t))}val(t){return t!==void 0?(this.key=t,this.itemEl.html(this.getTitle(t)),this):this.key}}const pl={number:/(^\d+$)|(^\d+(\.\d{0,4})?$)/,date:/^\d{4}-\d{1,2}-\d{1,2}$/};class U{constructor(t,e,s,i){this.label="",this.rule=e,s&&(this.label=u("label","label").css("width",`${i}px`).html(s)),this.tip=u("div","tip").child("tip").hide(),this.input=t,this.input.vchange=()=>this.validate(),this.el=u("div",`${m}-form-field`).children(this.label,t.el,this.tip)}isShow(){return this.el.css("display")!=="none"}show(){this.el.show()}hide(){return this.el.hide(),this}val(t){return this.input.val(t)}hint(t){this.input.hint(t)}validate(){const{input:t,rule:e,tip:s,el:i}=this,r=t.val();return e.required&&/^\s*$/.test(r)?(s.html($("validation.required")),i.addClass("error"),!1):(e.type||e.pattern)&&!(e.pattern||pl[e.type]).test(r)?(s.html($("validation.notMatch")),i.addClass("error"),!1):(i.removeClass("error"),!0)}}const Me=100;class ml extends gl{constructor(){const t=new U(new Bt("cell",["cell"],"100%",c=>$(`dataValidation.modeType.${c}`)),{required:!0},`${$("dataValidation.range")}:`,Me),e=new U(new ct("120px","E3 or E3:F12"),{required:!0,pattern:/^([A-Z]{1,2}[1-9]\d*)(:[A-Z]{1,2}[1-9]\d*)?$/}),s=new U(new Bt("list",["list","number","date","phone","email"],"100%",c=>$(`dataValidation.type.${c}`),c=>this.criteriaSelected(c)),{required:!0},`${$("dataValidation.criteria")}:`,Me),i=new U(new Bt("be",["be","nbe","eq","neq","lt","lte","gt","gte"],"160px",c=>$(`dataValidation.operator.${c}`),c=>this.criteriaOperatorSelected(c)),{required:!0}).hide(),r=new U(new ct("70px","10"),{required:!0}).hide(),n=new U(new ct("70px","100"),{required:!0,type:"number"}).hide(),o=new U(new ct("120px","a,b,c"),{required:!0}),h=new U(new ct("70px","10"),{required:!0,type:"number"}).hide();super($("contextmenu.validation"),[u("div",`${m}-form-fields`).children(t.el,e.el),u("div",`${m}-form-fields`).children(s.el,i.el,r.el,n.el,h.el,o.el),u("div",`${m}-buttons`).children(new tt("cancel").on("click",()=>this.btnClick("cancel")),new tt("remove").on("click",()=>this.btnClick("remove")),new tt("save","primary").on("click",()=>this.btnClick("save")))]),this.mf=t,this.rf=e,this.cf=s,this.of=i,this.minvf=r,this.maxvf=n,this.vf=h,this.svf=o,this.change=()=>{}}showVf(t){const e=t==="date"?"2018-11-12":"10",{vf:s}=this;s.input.hint(e),s.show()}criteriaSelected(t){const{of:e,minvf:s,maxvf:i,vf:r,svf:n}=this;t==="date"||t==="number"?(e.show(),s.rule.type=t,i.rule.type=t,t==="date"?(s.hint("2018-11-12"),i.hint("2019-11-12")):(s.hint("10"),i.hint("100")),s.show(),i.show(),r.hide(),n.hide()):(t==="list"?n.show():n.hide(),r.hide(),e.hide(),s.hide(),i.hide())}criteriaOperatorSelected(t){if(!t)return;const{minvf:e,maxvf:s,vf:i}=this;if(t==="be"||t==="nbe")e.show(),s.show(),i.hide();else{const r=this.cf.val();i.rule.type=r,r==="date"?i.hint("2018-11-12"):i.hint("10"),i.show(),e.hide(),s.hide()}}btnClick(t){if(t==="cancel")this.hide();else if(t==="remove")this.change("remove"),this.hide();else if(t==="save"){const e=["mf","rf","cf","of","svf","vf","minvf","maxvf"];for(let h=0;h<e.length;h+=1){const c=this[e[h]];if(c.isShow()&&!c.validate())return}const s=this.mf.val(),i=this.rf.val(),r=this.cf.val(),n=this.of.val();let o=this.svf.val();(r==="number"||r==="date")&&(n==="be"||n==="nbe"?o=[this.minvf.val(),this.maxvf.val()]:o=this.vf.val()),this.change("save",s,i,{type:r,operator:n,required:!1,value:o}),this.hide()}}setValue(t){if(t){const{mf:e,rf:s,cf:i,of:r,svf:n,vf:o,minvf:h,maxvf:c}=this,{mode:d,ref:a,validator:f}=t,{type:g,operator:p,value:w}=f||{type:"list"};e.val(d||"cell"),s.val(a),i.val(g),r.val(p),Array.isArray(w)?(h.val(w[0]),c.val(w[1])):(n.val(w||""),o.val(w||"")),this.criteriaSelected(g),this.criteriaOperatorSelected(p)}this.show()}}function ns(l){return u("div",`${m}-item ${l}`)}function He(l){return ns("state").child($(`sort.${l}`)).on("click.stop",()=>this.itemClick(l))}function wl(l){const{filterbEl:t,filterValues:e}=this;t.html(""),Object.keys(l).forEach((i,r)=>{const n=l[i],o=e.includes(i)?"checked":"";t.child(u("div",`${m}-item state ${o}`).on("click.stop",()=>this.filterClick(r,i)).children(i===""?$("filter.empty"):i,u("div","label").html(`(${n})`)))})}function _e(){const{filterhEl:l,filterValues:t,values:e}=this;l.html(`${t.length} / ${e.length}`),l.checked(t.length===e.length)}class bl{constructor(){this.filterbEl=u("div",`${m}-body`),this.filterhEl=u("div",`${m}-header state`).on("click.stop",()=>this.filterClick(0,"all")),this.el=u("div",`${m}-sort-filter`).children(this.sortAscEl=He.call(this,"asc"),this.sortDescEl=He.call(this,"desc"),ns("divider"),u("div",`${m}-filter`).children(this.filterhEl,this.filterbEl),u("div",`${m}-buttons`).children(new tt("cancel").on("click",()=>this.btnClick("cancel")),new tt("ok","primary").on("click",()=>this.btnClick("ok")))).hide(),this.ci=null,this.sortDesc=null,this.values=null,this.filterValues=[]}btnClick(t){if(t==="ok"){const{ci:e,sort:s,filterValues:i}=this;this.ok&&this.ok(e,s,"in",i)}this.hide()}itemClick(t){this.sort=t;const{sortAscEl:e,sortDescEl:s}=this;e.checked(t==="asc"),s.checked(t==="desc")}filterClick(t,e){const{filterbEl:s,filterValues:i,values:r}=this,n=s.children();e==="all"?n.length===i.length?(this.filterValues=[],n.forEach(o=>u(o).checked(!1))):(this.filterValues=Array.from(r),n.forEach(o=>u(o).checked(!0))):u(n[t]).toggle("checked")?i.push(e):i.splice(i.findIndex(h=>h===e),1),_e.call(this)}set(t,e,s,i){this.ci=t;const{sortAscEl:r,sortDescEl:n}=this;i!==null?(this.sort=i.order,r.checked(i.asc()),n.checked(i.desc())):(this.sortDesc=null,r.checked(!1),n.checked(!1)),this.values=Object.keys(e),this.filterValues=s?Array.from(s.value):Object.keys(e),wl.call(this,e,s),_e.call(this)}setOffset(t){this.el.offset(t).show();let e=1;mt(this.el,()=>{e<=0&&this.hide(),e-=1})}show(){this.el.show()}hide(){this.el.hide(),at(this.el)}}function os(l,t){const e=u("div",`${m}-toast`),s=u("div",`${m}-dimmer active`),i=()=>{document.body.removeChild(e.el),document.body.removeChild(s.el)};e.children(u("div",`${m}-toast-header`).children(new D("close").on("click.stop",()=>i()),l),u("div",`${m}-toast-content`).html(t)),document.body.appendChild(e.el),document.body.appendChild(s.el);const{width:r,height:n}=e.box(),{clientHeight:o,clientWidth:h}=document.documentElement;e.offset({left:(h-r)/2,top:(o-n)/3})}function Vt(l,t){let e;return(...s)=>{const i=this,r=s;e||(e=setTimeout(()=>{e=null,l.apply(i,r)},t))}}function vl(){const{data:l,verticalScrollbar:t,horizontalScrollbar:e}=this,{l:s,t:i,left:r,top:n,width:o,height:h}=l.getSelectedRect(),c=this.getTableOffset();if(Math.abs(r)+o>c.width)e.move({left:s+o-c.width});else{const d=l.freezeTotalWidth();r<d&&e.move({left:s-1-d})}if(Math.abs(n)+h>c.height)t.move({top:i+h-c.height-1});else{const d=l.freezeTotalHeight();n<d&&t.move({top:i-1-d})}}function et(l,t,e,s=!0,i=!1){if(t===-1&&e===-1)return;const{table:r,selector:n,toolbar:o,data:h,contextMenu:c}=this;c.setMode(t===-1||e===-1?"row-col":"range");const d=h.getCell(t,e);l?(n.setEnd(t,e,i),this.trigger("cells-selected",d,n.range)):(n.set(t,e,s),this.trigger("cell-selected",d,t,e)),o.reset(),r.render()}function N(l,t){const{selector:e,data:s}=this,{rows:i,cols:r}=s;let[n,o]=e.indexes;const{eri:h,eci:c}=e.range;l&&([n,o]=e.moveIndexes),t==="left"?o>0&&(o-=1):t==="right"?(c!==o&&(o=c),o<r.len-1&&(o+=1)):t==="up"?n>0&&(n-=1):t==="down"?(h!==n&&(n=h),n<i.len-1&&(n+=1)):t==="row-first"?o=0:t==="row-last"?o=r.len-1:t==="col-first"?n=0:t==="col-last"&&(n=i.len-1),l&&(e.moveIndexes=[n,o]),et.call(this,l,n,o),vl.call(this)}function xl(l){if(l.buttons!==0||l.target.className===`${m}-resizer-hover`)return;const{offsetX:t,offsetY:e}=l,{rowResizer:s,colResizer:i,tableEl:r,data:n}=this,{rows:o,cols:h}=n;if(t>h.indexWidth&&e>o.height){s.hide(),i.hide();return}const c=r.box(),d=n.getCellRectByXY(l.offsetX,l.offsetY);d.ri>=0&&d.ci===-1?(d.width=h.indexWidth,s.show(d,{width:c.width}),o.isHide(d.ri-1)?s.showUnhide(d.ri):s.hideUnhide()):s.hide(),d.ri===-1&&d.ci>=0?(d.height=o.height,i.show(d,{height:c.height}),h.isHide(d.ci-1)?i.showUnhide(d.ci):i.hideUnhide()):i.hide()}function yl(l){const{verticalScrollbar:t,horizontalScrollbar:e,data:s}=this,{top:i}=t.scroll(),{left:r}=e.scroll(),{rows:n,cols:o}=s,{deltaY:h,deltaX:c}=l,d=(b,v)=>{let C=b,x=0;do x=v(C),C+=1;while(x<=0);return x},a=b=>{if(b>0){const v=s.scroll.ri+1;if(v<n.len){const C=d(v,x=>n.getHeight(x));t.move({top:i+C-1})}}else{const v=s.scroll.ri-1;if(v>=0){const C=d(v,x=>n.getHeight(x));t.move({top:v===0?0:i-C})}}},f=b=>{if(b>0){const v=s.scroll.ci+1;if(v<o.len){const C=d(v,x=>o.getWidth(x));e.move({left:r+C-1})}}else{const v=s.scroll.ci-1;if(v>=0){const C=d(v,x=>o.getWidth(x));e.move({left:v===0?0:r-C})}}},g=Math.abs(h),p=Math.abs(c),w=Math.max(g,p);/Firefox/i.test(window.navigator.userAgent)&&Vt(a(l.detail),50),w===p&&Vt(f(c),50),w===g&&Vt(a(h),50)}function Cl(l,t){const{verticalScrollbar:e,horizontalScrollbar:s}=this,{top:i}=e.scroll(),{left:r}=s.scroll();l==="left"||l==="right"?s.move({left:r-t}):(l==="up"||l==="down")&&e.move({top:i-t})}function fe(){const{data:l,verticalScrollbar:t}=this,{height:e}=this.getTableOffset(),s=l.exceptRowTotalHeight(0,-1);t.set(e,l.rows.totalHeight()-s)}function ue(){const{data:l,horizontalScrollbar:t}=this,{width:e}=this.getTableOffset();l&&t.set(e,l.cols.totalWidth())}function kl(){const{selector:l,data:t,editor:e}=this,[s,i]=t.freeze;if(s>0||i>0){const r=t.freezeTotalWidth(),n=t.freezeTotalHeight();e.setFreezeLengths(r,n)}l.resetAreaOffset()}function I(){const{tableEl:l,overlayerEl:t,overlayerCEl:e,table:s,toolbar:i,selector:r,el:n}=this,o=this.getTableOffset(),h=this.getRect();l.attr(h),t.offset(h),e.offset(o),n.css("width",`${h.width}px`),fe.call(this),ue.call(this),kl.call(this),s.render(),i.reset(),r.reset()}function wt(){const{data:l,selector:t}=this;l.clearClipboard(),t.hideClipboard()}function ie(){const{data:l,selector:t}=this;l.copy(),l.copyToSystemClipboard(),t.showClipboard()}function We(){const{data:l,selector:t}=this;l.cut(),t.showClipboard()}function gt(l,t){const{data:e}=this;if(e.settings.mode!=="read"){if(e.paste(l,s=>os("Tip",s)))I.call(this);else if(t){const s=t.clipboardData.getData("text/plain");this.data.pasteFromText(s),I.call(this)}}}function El(){this.data.hideRowsOrCols(),I.call(this)}function Pe(l,t){this.data.unhideRowsOrCols(l,t),I.call(this)}function Sl(){const{data:l}=this;l.autofilter(),I.call(this)}function Fl(){const{toolbar:l}=this;l.paintformatActive()&&(gt.call(this,"format"),wt.call(this),l.paintformatToggle())}function Ne(l){const{selector:t,data:e,table:s,sortFilter:i}=this,{offsetX:r,offsetY:n}=l,o=l.target.className===`${m}-selector-corner`,h=e.getCellRectByXY(r,n),{left:c,top:d,width:a,height:f}=h;let{ri:g,ci:p}=h;const{autoFilter:w}=e;if(w.includes(g,p)&&c+a-20<r&&d+f-20<n){const b=w.items(p,(v,C)=>e.rows.getCell(v,C));i.hide(),i.set(p,b,w.getFilter(p),w.getSort(p)),i.setOffset({left:c,top:d+f+2});return}l.shiftKey||(o?t.showAutofill(g,p):et.call(this,!1,g,p),Ue(window,b=>{({ri:g,ci:p}=e.getCellRectByXY(b.offsetX,b.offsetY)),o?t.showAutofill(g,p):b.buttons===1&&!b.shiftKey&&et.call(this,!0,g,p,!0,!0)},()=>{o&&t.arange&&e.settings.mode!=="read"&&e.autofill(t.arange,"all",b=>os("Tip",b))&&s.render(),t.hideAutofill(),Fl.call(this)})),!o&&l.buttons===1&&l.shiftKey&&et.call(this,!0,g,p)}function bt(){const{editor:l,data:t}=this,e=t.getSelectedRect(),s=this.getTableOffset();let i="top";e.top>s.height/2&&(i="bottom"),l.setOffset(e,i)}function pt(){const{editor:l,data:t}=this;t.settings.mode!=="read"&&(bt.call(this),l.setCell(t.getSelectedCell(),t.getSelectedValidator()),wt.call(this))}function $l(l){const{data:t,table:e,selector:s}=this;t.scrolly(l,()=>{s.resetBRLAreaOffset(),bt.call(this),e.render()})}function Dl(l){const{data:t,table:e,selector:s}=this;t.scrollx(l,()=>{s.resetBRTAreaOffset(),bt.call(this),e.render()})}function Tl(l,t){const{ri:e}=l,{table:s,selector:i,data:r}=this;r.rows.setHeight(e,t),s.render(),i.resetAreaOffset(),fe.call(this),bt.call(this)}function Ol(l,t){const{ci:e}=l,{table:s,selector:i,data:r}=this;r.cols.setWidth(e,t),s.render(),i.resetAreaOffset(),ue.call(this),bt.call(this)}function Lt(l,t="finished"){const{data:e,table:s}=this;if(e.settings.mode==="read")return;e.setSelectedCellText(l,t);const{ri:i,ci:r}=e.selector;t==="finished"?s.render():this.trigger("cell-edited",l,i,r)}function $t(l){const{data:t}=this;t.settings.mode!=="read"&&(l==="insert-row"?t.insert("row"):l==="delete-row"?t.delete("row"):l==="insert-column"?t.insert("column"):l==="delete-column"?t.delete("column"):l==="delete-cell"?t.deleteCell():l==="delete-cell-format"?t.deleteCell("format"):l==="delete-cell-text"?t.deleteCell("text"):l==="cell-printable"?t.setSelectedCellAttr("printable",!0):l==="cell-non-printable"?t.setSelectedCellAttr("printable",!1):l==="cell-editable"?t.setSelectedCellAttr("editable",!0):l==="cell-non-editable"&&t.setSelectedCellAttr("editable",!1),wt.call(this),I.call(this))}function Al(l,t){const{data:e}=this;if(l==="undo")this.undo();else if(l==="redo")this.redo();else if(l==="print")this.print.preview();else if(l==="paintformat")t===!0?ie.call(this):wt.call(this);else if(l==="clearformat")$t.call(this,"delete-cell-format");else if(l!=="link"){if(l!=="chart")if(l==="autofilter")Sl.call(this);else if(l==="freeze")if(t){const{ri:s,ci:i}=e.selector;this.freeze(s,i)}else this.freeze(0,0);else e.setSelectedCellAttr(l,t),l==="formula"&&!e.selector.multiple()&&pt.call(this),I.call(this)}}function zl(l,t,e,s){this.data.setAutoFilter(l,t,e,s),I.call(this)}function Rl(){const{selector:l,overlayerEl:t,rowResizer:e,colResizer:s,verticalScrollbar:i,horizontalScrollbar:r,editor:n,contextMenu:o,toolbar:h,modalValidation:c,sortFilter:d}=this;t.on("mousemove",a=>{xl.call(this,a)}).on("mousedown",a=>{n.clear(),o.hide(),a.buttons===2?(this.data.xyInSelectedRect(a.offsetX,a.offsetY)||Ne.call(this,a),o.setPosition(a.offsetX,a.offsetY),a.stopPropagation()):a.detail===2?pt.call(this):Ne.call(this,a)}).on("mousewheel.stop",a=>{yl.call(this,a)}).on("mouseout",a=>{const{offsetX:f,offsetY:g}=a;g<=0&&s.hide(),f<=0&&e.hide()}),l.inputChange=a=>{Lt.call(this,a,"input"),pt.call(this)},Ns(t.el,{move:(a,f)=>{Cl.call(this,a,f)}}),h.change=(a,f)=>Al.call(this,a,f),d.ok=(a,f,g,p)=>zl.call(this,a,f,g,p),e.finishedFn=(a,f)=>{Tl.call(this,a,f)},s.finishedFn=(a,f)=>{Ol.call(this,a,f)},e.unhideFn=a=>{Pe.call(this,"row",a)},s.unhideFn=a=>{Pe.call(this,"col",a)},i.moveFn=(a,f)=>{$l.call(this,a,f)},r.moveFn=(a,f)=>{Dl.call(this,a,f)},n.change=(a,f)=>{Lt.call(this,f,a)},c.change=(a,...f)=>{a==="save"?this.data.addValidation(...f):this.data.removeValidation()},o.itemClick=a=>{a==="validation"?c.setValue(this.data.getSelectedValidation()):a==="copy"?ie.call(this):a==="cut"?We.call(this):a==="paste"?gt.call(this,"all"):a==="paste-value"?gt.call(this,"text"):a==="paste-format"?gt.call(this,"format"):a==="hide"?El.call(this):$t.call(this,a)},M(window,"resize",()=>{this.reload()}),M(window,"click",a=>{this.focusing=t.contains(a.target)}),M(window,"paste",a=>{this.focusing&&(gt.call(this,"all",a),a.preventDefault())}),M(window,"keydown",a=>{if(!this.focusing)return;const f=a.keyCode||a.which,{key:g,ctrlKey:p,shiftKey:w,metaKey:b}=a;if(p||b)switch(f){case 90:this.undo(),a.preventDefault();break;case 89:this.redo(),a.preventDefault();break;case 67:ie.call(this),a.preventDefault();break;case 88:We.call(this),a.preventDefault();break;case 85:h.trigger("underline"),a.preventDefault();break;case 86:break;case 37:N.call(this,w,"row-first"),a.preventDefault();break;case 38:N.call(this,w,"col-first"),a.preventDefault();break;case 39:N.call(this,w,"row-last"),a.preventDefault();break;case 40:N.call(this,w,"col-last"),a.preventDefault();break;case 32:et.call(this,!1,-1,this.data.selector.ci,!1),a.preventDefault();break;case 66:h.trigger("bold");break;case 73:h.trigger("italic");break}else{switch(f){case 32:w&&et.call(this,!1,this.data.selector.ri,-1,!1);break;case 27:o.hide(),wt.call(this);break;case 37:N.call(this,w,"left"),a.preventDefault();break;case 38:N.call(this,w,"up"),a.preventDefault();break;case 39:N.call(this,w,"right"),a.preventDefault();break;case 40:N.call(this,w,"down"),a.preventDefault();break;case 9:n.clear(),N.call(this,!1,w?"left":"right"),a.preventDefault();break;case 13:n.clear(),N.call(this,!1,w?"up":"down"),a.preventDefault();break;case 8:$t.call(this,"delete-cell-text"),a.preventDefault();break}g==="Delete"?($t.call(this,"delete-cell-text"),a.preventDefault()):f>=65&&f<=90||f>=48&&f<=57||f>=96&&f<=105||a.key==="="?(Lt.call(this,a.key,"input"),pt.call(this)):f===113&&pt.call(this)}})}class Il{constructor(t,e){this.eventMap=Bs();const{view:s,showToolbar:i,showContextmenu:r}=e.settings;this.el=u("div",`${m}-sheet`),this.toolbar=new ul(e,s.width,!i),this.print=new ki(e),t.children(this.toolbar.el,this.el,this.print.el),this.data=e,this.tableEl=u("canvas",`${m}-table`),this.rowResizer=new Ce(!1,e.rows.height),this.colResizer=new Ce(!0,e.cols.minWidth),this.verticalScrollbar=new ke(!0),this.horizontalScrollbar=new ke(!1),this.editor=new ri(fi,()=>this.getTableOffset(),e.rows.height),this.modalValidation=new ml,this.contextMenu=new $i(()=>this.getRect(),!r),this.selector=new qs(e),this.overlayerCEl=u("div",`${m}-overlayer-content`).children(this.editor.el,this.selector.el),this.overlayerEl=u("div",`${m}-overlayer`).child(this.overlayerCEl),this.sortFilter=new bl,this.el.children(this.tableEl,this.overlayerEl.el,this.rowResizer.el,this.colResizer.el,this.verticalScrollbar.el,this.horizontalScrollbar.el,this.contextMenu.el,this.modalValidation.el,this.sortFilter.el),this.table=new xi(this.tableEl.el,e),Rl.call(this),I.call(this),et.call(this,!1,0,0)}on(t,e){return this.eventMap.on(t,e),this}trigger(t,...e){const{eventMap:s}=this;s.fire(t,e)}resetData(t){this.editor.clear(),this.data=t,fe.call(this),ue.call(this),this.toolbar.resetData(t),this.print.resetData(t),this.selector.resetData(t),this.table.resetData(t)}loadData(t){return this.data.setData(t),I.call(this),this}freeze(t,e){const{data:s}=this;return s.setFreeze(t,e),I.call(this),this}undo(){this.data.undo(),I.call(this)}redo(){this.data.redo(),I.call(this)}reload(){return I.call(this),this}getRect(){const{data:t}=this;return{width:t.viewWidth(),height:t.viewHeight()}}getTableOffset(){const{rows:t,cols:e}=this.data,{width:s,height:i}=this.getRect();return{width:s-e.indexWidth,height:i-t.height,left:e.indexWidth,top:t.height}}}class Ml extends L{constructor(t){const e=new D("ellipsis");super(e,"auto",!1,"top-left"),this.contentClick=t}reset(t){const e=t.map((s,i)=>u("div",`${m}-item`).css("width","150px").css("font-weight","normal").on("click",()=>{this.contentClick(i),this.hide()}).child(s));this.setContentChildren(...e)}setTitle(){}}const Hl=[{key:"delete",title:E("contextmenu.deleteSheet")}];function _l(l){return u("div",`${m}-item`).child(l.title()).on("click",()=>{this.itemClick(l.key),this.hide()})}function Wl(){return Hl.map(l=>_l.call(this,l))}class Pl{constructor(){this.el=u("div",`${m}-contextmenu`).css("width","160px").children(...Wl.call(this)).hide(),this.itemClick=()=>{}}hide(){const{el:t}=this;t.hide(),at(t)}setOffset(t){const{el:e}=this;e.offset(t),e.show(),mt(e)}}class Nl{constructor(t=()=>{},e=()=>{},s=()=>{},i=()=>{}){this.swapFunc=e,this.updateFunc=i,this.dataNames=[],this.activeEl=null,this.deleteEl=null,this.items=[],this.moreEl=new Ml(r=>{this.clickSwap2(this.items[r])}),this.contextMenu=new Pl,this.contextMenu.itemClick=s,this.el=u("div",`${m}-bottombar`).children(this.contextMenu.el,this.menuEl=u("ul",`${m}-menu`).child(u("li","").children(new D("add").on("click",()=>{t()}),u("span","").child(this.moreEl))))}addItem(t,e){this.dataNames.push(t);const s=u("li",e?"active":"").child(t);s.on("click",()=>{this.clickSwap2(s)}).on("contextmenu",i=>{const{offsetLeft:r,offsetHeight:n}=i.target;this.contextMenu.setOffset({left:r,bottom:n+1}),this.deleteEl=s}).on("dblclick",()=>{const i=s.html(),r=new ct("auto","");r.val(i),r.input.on("blur",({target:n})=>{const{value:o}=n,h=this.dataNames.findIndex(c=>c===i);this.renameItem(h,o)}),s.html("").child(r.el),r.focus()}),e&&this.clickSwap(s),this.items.push(s),this.menuEl.child(s),this.moreEl.reset(this.dataNames)}renameItem(t,e){this.dataNames.splice(t,1,e),this.moreEl.reset(this.dataNames),this.items[t].html("").child(e),this.updateFunc(t,e)}clear(){this.items.forEach(t=>{this.menuEl.removeChild(t.el)}),this.items=[],this.dataNames=[],this.moreEl.reset(this.dataNames)}deleteItem(){const{activeEl:t,deleteEl:e}=this;if(this.items.length>1){const s=this.items.findIndex(i=>i===e);if(this.items.splice(s,1),this.dataNames.splice(s,1),this.menuEl.removeChild(e.el),this.moreEl.reset(this.dataNames),t===e){const[i]=this.items;return this.activeEl=i,this.activeEl.toggle(),[s,0]}return[s,-1]}return[-1]}clickSwap2(t){const e=this.items.findIndex(s=>s===t);this.clickSwap(t),this.activeEl.toggle(),this.swapFunc(e)}clickSwap(t){this.activeEl!==null&&this.activeEl.toggle(),this.activeEl=t}}class hs{constructor(t,e={}){let s=t;this.options={showBottomBar:!0,...e},this.sheetIndex=1,this.datas=[],typeof t=="string"&&(s=document.querySelector(t)),this.bottombar=this.options.showBottomBar?new Nl(()=>{const r=this.addSheet();this.sheet.resetData(r)},r=>{const n=this.datas[r];this.sheet.resetData(n)},()=>{this.deleteSheet()},(r,n)=>{this.datas[r].name=n}):null,this.data=this.addSheet();const i=u("div",`${m}`).on("contextmenu",r=>r.preventDefault());s.appendChild(i.el),this.sheet=new Il(i,this.data),this.bottombar!==null&&i.child(this.bottombar.el)}addSheet(t,e=!0){const s=t||`sheet${this.sheetIndex}`,i=new Ps(s,this.options);return i.change=(...r)=>{this.sheet.trigger("change",...r)},this.datas.push(i),this.bottombar!==null&&this.bottombar.addItem(s,e),this.sheetIndex+=1,i}deleteSheet(){if(this.bottombar===null)return;const[t,e]=this.bottombar.deleteItem();t>=0&&(this.datas.splice(t,1),e>=0&&this.sheet.resetData(this.datas[e]))}loadData(t){const e=Array.isArray(t)?t:[t];if(this.bottombar!==null&&this.bottombar.clear(),this.datas=[],e.length>0)for(let s=0;s<e.length;s+=1){const i=e[s],r=this.addSheet(i.name,s===0);r.setData(i),s===0&&this.sheet.resetData(r)}return this}getData(){return this.datas.map(t=>t.getData())}cellText(t,e,s,i=0){return this.datas[i].setCellText(t,e,s,"finished"),this}cell(t,e,s=0){return this.datas[s].getCell(t,e)}cellStyle(t,e,s=0){return this.datas[s].getCellStyle(t,e)}reRender(){return this.sheet.table.render(),this}on(t,e){return this.sheet.on(t,e),this}validate(){const{validations:t}=this.data;return t.errors.size<=0}change(t){return this.sheet.on("change",t),this}static locale(t,e){Ye(t,e)}}const Bl=(l,t={})=>new hs(l,t);typeof window<"u"&&(window.x_spreadsheet=Bl,window.x_spreadsheet.locale=(l,t)=>Ye(l,t));const qt=["#FFFFFF","#000000","#BFBFBF","#323232","#4472C4","#ED7D31","#A5A5A5","#FFC000","#5B9BD5","#71AD47"],Yt=["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#800000","#008000","#000080","#808000","#800080","#008080","#C0C0C0","#808080","#9999FF","#993366","#FFFFCC","#CCFFFF","#660066","#FF8080","#0066CC","#CCCCFF","#000080","#FF00FF","#FFFF00","#00FFFF","#800080","#800000","#008080","#0000FF","#00CCFF","#CCFFFF","#CCFFCC","#FFFF99","#99CCFF","#FF99CC","#CC99FF","#FFCC99","#3366FF","#33CCCC","#99CC00","#FFCC00","#FF9900","#FF6600","#666699","#969696","#003366","#339966","#003300","#333300","#993300","#993366","#333399","#333333","#FFFFFF"],Vl=80,Ll=24;function ql(l){try{return new cs.Workbook().xlsx.load(l)}catch(t){return console.warn(t),Promise.reject(t)}}function Yl(l,t,e){for(let s=0;s<(l.columns||[]).length;s++)t.cols[s.toString()]={},l.columns[s].width?t.cols[s.toString()].width=l.columns[s].width*6+(e.widthOffset||0):t.cols[s.toString()].width=Vl+(e.widthOffset||0);t.cols.len=Math.max(Object.keys(t.cols).length,e.minColLength||0)}function jl(l){const{numFmt:t,value:e,type:s}=l;switch(s){case 2:try{if(l.style.numFmt){if(l.style.numFmt.endsWith("%")){const i=l.style.numFmt.match(/\.(\d+)%/);return i?(Number(e)*100).toFixed(i[1].length)+"%":Number(e)*100+"%"}else if(/0(?:\.0+)?/.test(l.style.numFmt)){if(Number(e)===0&&l.style.numFmt.startsWith("_"))return"-";let i=l.style.numFmt.match(/0\.(0+)(_|;|$)/);i?i=i[1].length:i=0;let r=Number(e).toFixed(i)+"";if(l.style.numFmt.includes("#,##")){r=r.split(".");const n=r[0].split("").reverse(),o=[];for(let h=0;h<n.length;h++)o.push(n[h]),(h+1)%3===0&&h<n.length-1&&n[h+1]!=="-"&&o.push(",");r[0]=o.reverse().join(""),r=r.join(".")}return r}}return e+""}catch{return e}case 3:return e;case 4:switch(t){case"mm-dd-yy":return lt(e).format("YYYY/MM/DD");case"[$-F800]dddd, mmmm dd, yyyy":return lt(e).format("YYYY年M月D日 ddd");case'm"月"d"日";@':return lt(e).format("M月D日");case"yyyy/m/d h:mm;@":case'm/d/yy "h":mm':return lt(e).subtract(8,"hour").format("YYYY/M/DD HH:mm");case"h:mm;@":return lt(e).format("HH:mm");default:return lt(e).format("YYYY-MM-DD")}case 5:return e.text;case 6:return _t.get(e,"result.error")||e.result;case 8:return l.text;default:return e}}function jt(l){if(typeof l=="object")return"#000000";if(/^#?[a-f\d]{6}$/i.test(l))return l.startsWith("#")?l:"#"+l;l=l.trim().toLowerCase();const t={};try{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l)||"";return t.r=parseInt(e[2],16),t.g=parseInt(e[3],16),t.b=parseInt(e[4],16),t.a=parseInt(e[1],16)/255,as(`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`).toHexString()}catch(e){console.warn(e)}}function Ut(l,t){return l>9?"#C7C9CC":typeof t>"u"?qt[l]:t>0?ds(qt[l],t):fs(qt[l],Math.abs(t))}function Ul(l){l.style=_t.cloneDeep(l.style);let t=null;l.style.fill&&l.style.fill.fgColor&&(l.style.fill.fgColor.argb?t=jt(l.style.fill.fgColor.argb):Object.prototype.hasOwnProperty.call(l.style.fill.fgColor,"theme")?t=Ut(l.style.fill.fgColor.theme,l.style.fill.fgColor.tint):l.style.fill.fgColor.indexed?t=Yt[l.style.fill.fgColor.indexed]||"#C7C9CC":t="#C7C9CC"),t&&(l.style.bgcolor=t);let e=null;if(l.style.font&&l.style.font.color&&(l.style.font.color.argb?e=jt(l.style.font.color.argb):Object.prototype.hasOwnProperty.call(l.style.font.color,"theme")?e=Ut(l.style.font.color.theme,l.style.font.color.tint):l.style.font.color.indexed?e=Yt[l.style.font.color.indexed]||"#000000":e="#000000"),e&&(l.style.color=e),l.style.alignment&&(l.style.alignment.horizontal&&(l.style.align=l.style.alignment.horizontal),l.style.alignment.vertical&&(l.style.valign=l.style.alignment.vertical)),l.style.alignment&&l.style.alignment.wrapText&&(l.style.textwrap=!0),l.style.border){const s={};Object.keys(l.style.border).forEach(i=>{const r=l.style.border[i];let n="#000000";typeof r.color=="string"?n=r.color:r.color&&(r.color.argb?n=jt(r.color.argb)||"":Object.prototype.hasOwnProperty.call(r.color,"theme")?n=Ut(r.color.theme,r.color.tint):r.color.indexed&&(n=Yt[r.color.indexed])),s[i]=[r.style||"thin",n]}),l.style.border2={...l.style.border},l.style.border=s}return l.style}function Xl(l,t){const e=[];return l.eachSheet(s=>{const i={name:s.name,styles:[],rows:{},cols:{},merges:[],media:[]},r=[];for(const n in s._merges){i.merges.push(s._merges[n].shortRange);const o={};o.startAddress=s._merges[n].tl,o.endAddress=s._merges[n].br,o.YRange=s._merges[n].model.bottom-s._merges[n].model.top,o.XRange=s._merges[n].model.right-s._merges[n].model.left,r.push(o)}Yl(s,i,t),(s._rows||[]).forEach((n,o)=>{i.rows[o]={cells:{}},n.height?i.rows[o].height=n.height+(t.heightOffset||0):i.rows[o].height=Ll+(t.heightOffset||0),(n._cells||[]).forEach((h,c)=>{i.rows[o].cells[c]={};const d=_t.find(r,function(a){return a.startAddress===h._address});d&&h.master.address!==d.startAddress||(d&&(i.rows[o].cells[c].merge=[d.YRange,d.XRange]),i.rows[o].cells[c].text=jl(h),i.styles.push(Ul(h)),i.rows[o].cells[c].style=i.styles.length-1)})}),i._media&&(i.media=i._media),i.rows.len=Math.max(Object.keys(i.rows).length,100),e.push(i)}),{workbookData:e,workbookSource:l,medias:l.media||[]}}let Dt=[];function St(l,t,e,s){e&&e._media.length&&e._media.forEach(i=>{const{imageId:r,range:n,type:o}=i;if(o==="image"){const h=Kl(e,n,s);Zl(l,r,t[r],h)}})}const Tt=60,Ot=25,Xt=80,Kt=24,B=window.devicePixelRatio;function Kl(l,t,e){var s,i,r,n,o,h,c,d,a,f,g,p,w,b;const{tl:v={},br:C={}}=t,{nativeCol:x,nativeColOff:y,nativeRow:S,nativeRowOff:A}=v;let z=Tt,T=Ot;for(let O=0;O<x;O++)z+=((i=(s=l==null?void 0:l._columns)==null?void 0:s[O])==null?void 0:i.width)*6||Xt;for(let O=0;O<S;O++)T+=((n=(r=l==null?void 0:l._rows)==null?void 0:r[O])==null?void 0:n.height)||Kt;const it=z+y/12700,W=T+A/12700,{nativeCol:Z,nativeColOff:J,nativeRow:P,nativeRowOff:G}=C;let j;if(x===Z)j=(J-y)/12700;else{j=(((h=(o=l==null?void 0:l._columns)==null?void 0:o[x])==null?void 0:h.width)*6||Xt)-y/12700;for(let O=x+1;O<Z;O++)j+=((d=(c=l==null?void 0:l._columns)==null?void 0:c[O])==null?void 0:d.width)*6||Xt;j+=J/12700}let dt;if(S===P)dt=(G-A)/12700;else{dt=(((f=(a=l==null?void 0:l._rows)==null?void 0:a[S])==null?void 0:f.height)||Kt)-A/12700;for(let O=S+1;O<P;O++)dt+=((p=(g=l==null?void 0:l._rows)==null?void 0:g[O])==null?void 0:p.height)||Kt;dt+=G/12700}return{x:(it-(((w=e==null?void 0:e.scroll)==null?void 0:w.x)||0))*B,y:(W-(((b=e==null?void 0:e.scroll)==null?void 0:b.y)||0))*B,width:j*B,height:dt*B}}function Be(){Dt=[]}function Zl(l,t,e,s){Jl(t,e).then(i=>{let r=0,n=0,o=i.width,h=i.height,c=s.x,d=s.y,a=s.width,f=s.height;const g=a/o,p=f/h;if(c<Tt*B){const w=Tt*B-c;c=Tt*B,a-=w,o-=w/g,r+=w/g}if(d<Ot*B){const w=Ot*B-d;d=Ot*B,f-=w,h-=w/p,n+=w/p}l.drawImage(i,r,n,o,h,c,d,a,f)}).catch(i=>{})}function Jl(l,t){return new Promise((e,s)=>{if(Dt[l])return e(Dt[l]);const{buffer:i,extension:r}=t.buffer,n=new Blob([i],{type:"image/"+r}),o=URL.createObjectURL(n),h=new Image;h.src=o,h.onload=function(){e(h),Dt[l]=h},h.onerror=function(c){s(c)}})}function Gl(l){if(l){const t=l.querySelectorAll("input");for(const e of t)e&&!e.readOnly&&(e.readOnly=!0)}}const Ql={minColLength:20};class tr{constructor(t,e={}){H(this,"container"),H(this,"options",{}),H(this,"wrapper"),H(this,"wrapperMain"),H(this,"xs"),H(this,"sheetIndex"),H(this,"mediasSource"),H(this,"workbookDataSource"),H(this,"ctx"),H(this,"fileData"),H(this,"observer"),H(this,"offset"),this.container=t,this.options={...Ql,...e},this.sheetIndex=1,this.mediasSource={},this.workbookDataSource={_worksheets:[]},this.createWrapper(),this.initSpreadsheet(),this.hack()}createWrapper(){this.wrapper=document.createElement("div"),this.wrapper.className="r-preview-excel-main",this.container.appendChild(this.wrapper)}async initSpreadsheet(){var t;if(!this.wrapper&&typeof window<"u"||(this.xs=new hs(this.wrapper,{mode:"read",showToolbar:!1,showContextmenu:this.options.showContextmenu||!1,view:{height:()=>this.wrapper&&this.wrapper.clientHeight||300,width:()=>this.wrapper&&this.wrapper.clientWidth||1200},row:{height:24,len:100},col:{len:26,width:80,indexWidth:60,minWidth:60}}).loadData({}),!this.xs))return;if(this.xs.bottombar){const s=this.xs.bottombar.swapFunc;this.xs.bottombar.swapFunc=i=>{var r;s.call((r=this.xs)==null?void 0:r.bottombar,i),this.sheetIndex=i+1,setTimeout(()=>{var n,o;(n=this.xs)!=null&&n.reRender&&((o=this.xs)==null||o.reRender()),this.mediasSource&&this.ctx&&this.offset&&St(this.ctx,this.mediasSource,this.workbookDataSource._worksheets[this.sheetIndex],this.offset)})}}if((t=this.xs.sheet)!=null&&t.editor){const s=this.xs.sheet.editor.clear;this.xs.sheet.editor.clear=(...r)=>{var n,o;s.apply((o=(n=this.xs)==null?void 0:n.sheet)==null?void 0:o.editor,r),setTimeout(()=>{this.ctx&&this.mediasSource&&this.offset&&St(this.ctx,this.mediasSource,this.workbookDataSource._worksheets[this.sheetIndex],this.offset)})};const i=this.xs.sheet.editor.setOffset;this.xs.sheet.editor.setOffset=(...r)=>{var n,o;i.apply((o=(n=this.xs)==null?void 0:n.sheet)==null?void 0:o.editor,r),r.length>1&&(this.offset=r.shift()),this.ctx&&this.mediasSource&&this.offset&&St(this.ctx,this.mediasSource,this.workbookDataSource._worksheets[this.sheetIndex],this.offset)}}const e=this.wrapper&&this.wrapper.querySelector("canvas");e&&(this.ctx=e.getContext("2d"))}renderExcel(t){return this.fileData=t,ql(t).then(e=>{var s;if(!e._worksheets||e._worksheets.length===0)throw new Error("未获取到数据，可能文件格式不正确或文件已损坏");const{workbookData:i,medias:r,workbookSource:n}=Xl(e,this.options);this.mediasSource=r,this.workbookDataSource=n,this.offset=void 0,this.sheetIndex=1,Be(),(s=this.xs)==null||s.loadData(i),this.ctx&&this.mediasSource&&this.offset&&St(this.ctx,this.mediasSource,this.workbookDataSource._worksheets[this.sheetIndex],this.offset)}).catch(e=>{var s;return this.mediasSource=[],this.workbookDataSource={_worksheets:[]},Be(),(s=this.xs)==null||s.loadData({}),Promise.reject(e)})}hack(){if(!this.wrapper)return;const t=_t.debounce(Gl,200).bind(this,this.wrapper);this.observer=new MutationObserver(t);const e={attributes:!0,childList:!0,subtree:!0};this.observer.observe(this.wrapper,e),t()}}const ar=(l,t)=>{if(!t)return Promise.reject();const e=new tr(t);return new Promise((i,r)=>{const n=new FileReader;n.readAsArrayBuffer(l),n.onload=()=>{n.result?i(n==null?void 0:n.result):r()}}).then(i=>{e.renderExcel(i)})};export{ar as renderExcel};
